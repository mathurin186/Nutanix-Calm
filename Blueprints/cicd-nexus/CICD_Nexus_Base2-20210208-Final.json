{"status":{},"contains_secrets":true,"product_version":"3.2.0","spec":{"description":"jenkins master: http:\/\/@@{JenkinsMasterVM.address}@@:8080\/\njenkins credential: admin\/@@{JenkinsMasterVM.jenkins_authorization}@@\n\ndev workstation: @@{WorkstationVM.address}@@","resources":{"client_attrs":{"c11ad746-3346-4bb6-a861-7e6e938dada6":{"y":-295.6908352381,"x":-155.942448719},"None":{"y":-93.6992223702,"x":-224.1205593216},"5f18b67e_deployment":{"y":-309.2597676858,"x":113.6148091271},"8cafc62e_deployment":{"y":-750.5688529934,"x":116.6033082104},"fe95f237_deployment":{"y":-404.752374395,"x":-478.7680960245},"1afa7711_deployment":{"y":-680.4437312086,"x":-165.9216010518},"aa65c031_deployment":{"y":-473.7372212794,"x":432.3528396548}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Load Cert"},{"kind":"app_task","name":"Configure User"}],"name":"84e2678e_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Load Cert"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure User"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Cert","attrs":{"exit_status":[],"script":"echo \"Create host entries\"\necho \"@@{Nexus.address}@@ @@{Nexus_vmname}@@.@@{domain_name}@@ @@{Nexus_vmname}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n\necho \"Installing SSH Pass\"\nsudo apt install -y sshpass\necho \"Make directory to store Nexus certificate\"\nsudo mkdir \/etc\/docker\/certs.d\ncd \/etc\/docker\/certs.d\nsudo mkdir @@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\n\n#REGISTRY_IP=@@{Docker Registry.address}@@\nREGISTRY_IP=@@{Nexus.address}@@\nsshpass -p @@{Ubuntu Credential.secret}@@ scp -oStrictHostKeyChecking=no centos@${REGISTRY_IP}:~\/nexus_server.pem \/tmp\nsudo mv \/tmp\/nexus_server.pem \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\ncd \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\nsudo mv nexus_server.pem nexus_server.crt\n\necho \"Verify Nexus certificate\"\n\nsudo ls -la \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\n\necho \"Update CA Certificate and Restart Nexus to trust the certificate\"\nsudo update-ca-certificates\nsudo service docker restart\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure User","attrs":{"exit_status":[],"script":"sudo apt-get update\nmkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\n#echo 'export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@' >> ~\/.bashrc\necho 'export DOCKER_REGISTRY=@@{Nexus_vmname}@@.@@{domain_name}@@' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix Key.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa*\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a7befc49_runbook","main_task_local_reference":{"kind":"app_task","name":"84e2678e_dag"},"variable_list":[]},"name":"Configure Connectivity"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install NodeJS"}],"name":"ace9b0ce_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install NodeJS","attrs":{"exit_status":[],"script":"sudo apt install -y curl\ncurl -sL https:\/\/deb.nodesource.com\/setup_8.x -o nodesource_setup.sh\nsudo bash nodesource_setup.sh\nsudo apt-get install -y nodejs\nsudo apt-get install -y curl","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ffab2e14_runbook","main_task_local_reference":{"kind":"app_task","name":"ace9b0ce_dag"},"variable_list":[]},"name":"NodeJS Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins Master Details"},{"kind":"app_task","name":"Developer Workstation Details"},{"kind":"app_task","name":"Docker Repository Details"}],"name":"817f2161_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Developer Workstation Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Repository Details"}},{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Details"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Developer Workstation Details"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Jenkins Master Host Name:\"\nprint \"@@{Jenkins Master.name}@@\"\nprint \"\"\nprint \"Jenkins Master IP Address:\"\nprint \"@@{Jenkins Master.address}@@\"\nprint \"\"\nprint \"Initial Authorization Password:\"\nprint \"@@{Jenkins Master.jenkins_authorization}@@\"\nprint \"\"\nprint \"Jenkins Master URL:\"\nprint \"http:\/\/@@{Jenkins Master.address}@@:8080\/\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Developer Workstation Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Developer Workstaion Host Name:\"\nprint \"@@{name}@@\"\nprint \"\"\nprint \"Developer Workstaion IP Address:\"\nprint \"@@{address}@@\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Docker Repository Details","attrs":{"script":"print \"-------------------------\"\nprint \"\"\nprint \"Nexus Registry Host Name:\"\nprint \"@@{Nexus_vmname}@@\"\nprint \"\"\nprint \"Nexus Registry IP Address:\"\nprint \"@@{Nexus.address}@@\"\nprint \"\"\nprint \"Nexus Registry URLs:\"\nprint \"View Repositories:\"\nprint \"https:\/\/@@{Nexus_vmname}@@.@@{domain_name}@@\/repository\/test-group\/\"\nprint \"\"\nprint \"\"\nprint \"\"\nprint \"-------------------------\"","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0e71b583_runbook","main_task_local_reference":{"kind":"app_task","name":"817f2161_dag"},"variable_list":[]},"name":"Output Connection Details"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Initialize DevOps Repository"},{"kind":"app_task","name":"Download Version 1 Demo Code"},{"kind":"app_task","name":"Create and Push Docker Images"}],"name":"501ff368_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create and Push Docker Images"}},{"from_task_reference":{"kind":"app_task","name":"Initialize DevOps Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize DevOps Repository","attrs":{"exit_status":[],"script":"set -x\nsudo apt install -y git\necho \"Initialize @@{initial_project_name}@@ Git Project\"\ngit clone git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{initial_project_name}@@.git\n\ncd @@{initial_project_name}@@\n\ngit config user.name nutanix\ngit config user.email nutanix@@@{name}@@.@@{domain_name}@@\ngit config --global push.default matching\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Version 1 Demo Code","attrs":{"exit_status":[],"script":"set -x\nfilename=@@{initial_code_seed}@@\nurl=@@{initial_code_seed_location}@@\nurl=$(echo ${url}|sed 's\/\\\/$\/\/')\n\necho \"Get Demo Code\"\ncd @@{initial_project_name}@@\nwget ${url}\/${filename}\ntar xvfz ${filename}\nrm ${filename}\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create and Push Docker Images","attrs":{"exit_status":[],"script":"#!\/bin\/bash\necho \"Hello World\"\nset -x\n\nexport DOCKER_REGISTRY=@@{Nexus_vmname}@@.@@{domain_name}@@\n#export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@\nexport PROJECT_NAME=@@{initial_project_name}@@\necho \"Login into Nexus Registry\"\n#docker login -u @@{Docker Registry Credential.username}@@ -p @@{Docker Registry Credential.secret}@@ $DOCKER_REGISTRY\ndocker login -u @@{Nexus Jenkins Credential.username}@@ -p @@{Nexus Jenkins Credential.secret}@@ $DOCKER_REGISTRY:@@{Nexus_Repo_Port}@@\n\ncd ~\/@@{initial_project_name}@@\n\necho \"Build and Push Ansible Image\"\nwhile true ; do\n  #docker build -t ${DOCKER_REGISTRY}\/@@{initial_project_name}@@\/ansible docker-ansible\/src\n  \n  docker build -t ${DOCKER_REGISTRY}:@@{Nexus_Repo_Port}@@\/@@{initial_project_name}@@\/ansible docker-ansible\/src\n  if [ $? -eq 0 ]; then\n    break\n  else\n    sleep 15\n  fi\ndone\n\necho \"List out the docker images\"\ndocker images list\necho \"Tag the docker images\"\ndocker tag $(docker images | awk '{print $1}' | awk 'NR==2') @@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\/devops\/ansible:latest\n# docker push ${DOCKER_REGISTRY}:@@{Nexus_Repo_Port}@@\/@@{initial_project_name}@@\/ansible\necho \"Push the docker images into Nexus\"\ndocker push @@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\/devops\/ansible:latest\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"e45c29cd_runbook","main_task_local_reference":{"kind":"app_task","name":"501ff368_dag"},"variable_list":[]},"name":"Setup Demo Project"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Connectivity"},{"kind":"app_task","name":"Setup Demo Project"}],"name":"6b546dea_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Connectivity"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup Demo Project"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Connectivity","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a7befc49_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup Demo Project","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"e45c29cd_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"fb911f31_runbook","main_task_local_reference":{"kind":"app_task","name":"6b546dea_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"be256f71_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bed2d16c_runbook","main_task_local_reference":{"kind":"app_task","name":"be256f71_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"38cd3275_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d7e997fb_runbook","main_task_local_reference":{"kind":"app_task","name":"38cd3275_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Output Connection Details"}],"name":"bc0993e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Output Connection Details","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"0e71b583_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"9b3a9a95_runbook","main_task_local_reference":{"kind":"app_task","name":"bc0993e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04085076_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7f5595ea_runbook","main_task_local_reference":{"kind":"app_task","name":"04085076_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Update Installed OS Packages"},{"kind":"app_task","name":"Join DNS"},{"kind":"app_task","name":"Configure Package"},{"kind":"app_task","name":"Join AD Domain"}],"name":"320deff5_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Update Installed OS Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join DNS"}},{"from_task_reference":{"kind":"app_task","name":"Join DNS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Package"}},{"from_task_reference":{"kind":"app_task","name":"Configure Package"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Update Installed OS Packages","attrs":{"exit_status":[],"script":"sudo tee -a \/etc\/apt\/sources.list <<EOF\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic universe\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic-updates universe\nEOF\n\necho \"List out source repositories to update\"\ngrep -i \"^deb\" \/etc\/apt\/sources.list\n\nsudo apt update -y\nsudo apt upgrade -y\n\n#Cleaning up unwanted package\nsudo apt autoremove -y","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join DNS","attrs":{"exit_status":[],"script":"NODE_HOST=@@{name}@@.@@{domain_name}@@\nexport NODE_HOST\necho $NODE_HOST\n\nsudo hostnamectl set-hostname --static $NODE_HOST\necho \"# Added entries\" | sudo tee -a \/etc\/hosts\necho \"@@{address}@@ @@{name}@@.@@{domain_name}@@ @@{name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Domain_Server_IP}@@ @@{Domain_Server}@@.@@{domain_name}@@ @@{Domain_Server}@@\" | sudo tee -a \/etc\/hosts\n\necho \"search @@{domain_name}@@\" | sudo tee \/etc\/resolv.conf\necho \"nameserver @@{Domain_Server_IP}@@\" | sudo tee -a \/etc\/resolv.conf\n\nsudo systemctl disable systemd-resolved\nsudo systemctl stop systemd-resolved\n\n#sudo service resolvconf restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Package","attrs":{"exit_status":[],"script":"#sudo apt update -y\nsudo apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"exit_status":[],"script":"echo \"Host File\"\nsudo cat \/etc\/hosts\n\necho \"Discovering the domain\"\nsudo realm discover @@{domain_name}@@\n\necho \"Joining the domain\"\n\npassword=@@{Domain Administrator.secret}@@\n#password=Ntnx@Sg2020\nexport password\n#sudo echo $password | sudo \/usr\/sbin\/realm join @@{DOMAIN_NAME}@@  -U Administrator --os-name=\"`uname -o`\" --os-version=\"`uname -rsv`\" --verbose \nsudo echo $password | sudo realm join -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose \n\necho \"List the domain after joining\"\n\nsudo \/usr\/sbin\/realm list\n\necho \"Permitting all users\"\nsudo realm permit --all\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bda1febd_runbook","main_task_local_reference":{"kind":"app_task","name":"320deff5_dag"},"variable_list":[]},"name":"Join AD Domain"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"db400fa8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"exit_status":[],"script":"password=@@{Domain Administrator.secret}@@\nexport password\n\necho \"Leaving Active Directory Domain\"\nsudo echo $password | sudo realm leave -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose\nsudo realm list","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f9659979_runbook","main_task_local_reference":{"kind":"app_task","name":"db400fa8_dag"},"variable_list":[]},"name":"Unjoin AD Domain"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"}],"name":"22052537_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"set -x\n\nsudo apt install -y curl\nsudo apt-get -y remove docker docker-engine docker.io containerd runc\n\necho \"** Downloading Docker Repo Key...\"\ncurl -fsSL https:\/\/download.docker.com\/linux\/ubuntu\/gpg | sudo apt-key add -\n\necho \"** Adding Docker Repo...\"\nsudo add-apt-repository \"deb [arch=amd64] https:\/\/download.docker.com\/linux\/ubuntu $(lsb_release -cs) stable\"\n\necho \"** Apt Update...\"\nsudo apt-get -y update\n\necho \"** Set apt-cache policy for docker-ce...\"\napt-cache policy docker-ce\n\necho \"** Installing Docker CE...\"\nsudo apt-get install -y docker-ce docker-ce-cli containerd.io\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Ubuntu Credential.username}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a79c95b6_runbook","main_task_local_reference":{"kind":"app_task","name":"22052537_dag"},"variable_list":[]},"name":"Install Docker"}],"depends_on_list":[{"kind":"app_service","name":"Jenkins Slave"}],"name":"Developer Workstation","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Project Access"},{"kind":"app_task","name":"Init Demo Repository"}],"name":"7a9c8308_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Init Demo Repository"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Project Access","attrs":{"exit_status":[],"script":"\necho \"Create Key File\"\necho @@{jenkins_public_key}@@ >> ~\/gitolite-admin\/keydir\/jenkins.pub \n\necho \"Configure @@{initial_project_name}@@ Repository Access\"\necho \"repo @@{initial_project_name}@@\" >> ~\/gitolite-admin\/conf\/gitolite.conf\necho \"    RW+     =   @all\" >> ~\/gitolite-admin\/conf\/gitolite.conf \necho \"    R       =   jenkins\" >> ~\/gitolite-admin\/conf\/gitolite.conf \n\necho \"Check IN and Commit Changes\"\ncd gitolite-admin\ngit add keydir\/jenkins.pub\ngit add conf\/gitolite.conf\ngit config --global user.name nutanix\ngit config --global user.email nutanix@@@{domain_name}@@\ngit config --global push.default matching\ngit commit -m \"Added Jenkins\"\ngit push origin master\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Init Demo Repository","attrs":{"exit_status":[],"script":"echo \"Create and Configure Repository\"\nsudo su -c 'mkdir ~\/repositories\/devops.git' - git\nsudo su -c 'cd ~\/repositories\/devops.git && git init --bare' - git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"45466435_runbook","main_task_local_reference":{"kind":"app_task","name":"7a9c8308_dag"},"variable_list":[]},"name":"Configure Demo Project"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Gitolite"}],"name":"c8a23c68_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Gitolite","attrs":{"exit_status":[],"script":"sudo apt-get update\nmkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'set -o vi' >> ~\/.bashrc\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix Key.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa*\ncp ~\/.ssh\/id_rsa.pub ~\/.ssh\/authorized_keys\ncp ~\/.ssh\/id_rsa.pub \/tmp\/nutanix.pub\nchmod 644 \/tmp\/nutanix.pub\n\nsudo apt install -y git curl\n\nsudo adduser --system --shell \/bin\/bash --group --disabled-password --home \/home\/git git\nsudo su -c 'mkdir ~\/bin; chmod 750 ~\/bin' - git\nsudo su -c 'echo \"PATH=$PATH:~\/bin\" >> ~\/.profile' - git\nsudo su -c 'git clone https:\/\/github.com\/sitaramc\/gitolite' - git\nsudo su -c 'gitolite\/install -ln' - git\nsudo su -c 'gitolite setup -pk \/tmp\/nutanix.pub' - git\nrm \/tmp\/nutanix.pub\ngit clone git@@@{address}@@:gitolite-admin.git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a89a99a1_runbook","main_task_local_reference":{"kind":"app_task","name":"c8a23c68_dag"},"variable_list":[]},"name":"Gitolite Installation"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Demo Project"}],"name":"721b691f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Demo Project","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"45466435_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"46a5a223_runbook","main_task_local_reference":{"kind":"app_task","name":"721b691f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"629e64e1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b5d382ab_runbook","main_task_local_reference":{"kind":"app_task","name":"629e64e1_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a8bbd555_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ff208061_runbook","main_task_local_reference":{"kind":"app_task","name":"a8bbd555_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"f318fc86_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1f3c5465_runbook","main_task_local_reference":{"kind":"app_task","name":"f318fc86_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"343c4dea_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"35a13bd5_runbook","main_task_local_reference":{"kind":"app_task","name":"343c4dea_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Update Installed OS Packages"},{"kind":"app_task","name":"Join DNS"},{"kind":"app_task","name":"Configure Package"},{"kind":"app_task","name":"Join AD Domain"}],"name":"1bbd5444_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Update Installed OS Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join DNS"}},{"from_task_reference":{"kind":"app_task","name":"Join DNS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Package"}},{"from_task_reference":{"kind":"app_task","name":"Configure Package"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Update Installed OS Packages","attrs":{"exit_status":[],"script":"sudo tee -a \/etc\/apt\/sources.list <<EOF\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic universe\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic-updates universe\nEOF\n\necho \"List out source repositories to update\"\ngrep -i \"^deb\" \/etc\/apt\/sources.list\n\nsudo apt update -y\nsudo apt upgrade -y\n\n#Cleaning up unwanted package\nsudo apt autoremove -y","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join DNS","attrs":{"exit_status":[],"script":"NODE_HOST=@@{name}@@.@@{domain_name}@@\nexport NODE_HOST\necho $NODE_HOST\n\nsudo hostnamectl set-hostname --static $NODE_HOST\necho \"# Added entries\" | sudo tee -a \/etc\/hosts\necho \"@@{address}@@ @@{name}@@.@@{domain_name}@@ @@{name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Domain_Server_IP}@@ @@{Domain_Server}@@.@@{domain_name}@@ @@{Domain_Server}@@\" | sudo tee -a \/etc\/hosts\n\necho \"search @@{domain_name}@@\" | sudo tee \/etc\/resolv.conf\necho \"nameserver @@{Domain_Server_IP}@@\" | sudo tee -a \/etc\/resolv.conf\n\nsudo systemctl disable systemd-resolved\nsudo systemctl stop systemd-resolved\n\n#sudo service resolvconf restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Package","attrs":{"exit_status":[],"script":"#sudo apt update -y\nsudo apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"exit_status":[],"script":"echo \"Host File\"\nsudo cat \/etc\/hosts\n\necho \"Discovering the domain\"\nsudo realm discover @@{domain_name}@@\n\necho \"Joining the domain\"\n\npassword=@@{Domain Administrator.secret}@@\n#password=Ntnx@Sg2020\nexport password\n#sudo echo $password | sudo \/usr\/sbin\/realm join @@{DOMAIN_NAME}@@  -U Administrator --os-name=\"`uname -o`\" --os-version=\"`uname -rsv`\" --verbose \nsudo echo $password | sudo realm join -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose \n\necho \"List the domain after joining\"\n\nsudo \/usr\/sbin\/realm list\n\necho \"Permitting all users\"\nsudo realm permit --all\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c39e22fb_runbook","main_task_local_reference":{"kind":"app_task","name":"1bbd5444_dag"},"variable_list":[]},"name":"Join AD Domain"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"456e5081_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"exit_status":[],"script":"password=@@{Domain Administrator.secret}@@\nexport password\n\necho \"Leaving Active Directory Domain\"\nsudo echo $password | sudo realm leave -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose\nsudo realm list","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c4bb8281_runbook","main_task_local_reference":{"kind":"app_task","name":"456e5081_dag"},"variable_list":[]},"name":"Unjoin AD Domain"}],"depends_on_list":[],"name":"Gitolite","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH"}],"name":"0c7134af_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH","attrs":{"exit_status":[],"script":"mkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho 'StrictHostKeyChecking no' > ~\/.ssh\/config\n\necho \"Create SSH Keys\"\necho \"@@{Nutanix Key.secret}@@\" > ~\/.ssh\/id_rsa\necho \"@@{nutanix_public_key}@@\" > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa*\ncp ~\/.ssh\/id_rsa.pub  ~\/.ssh\/authorized_keys\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7ea304d1_runbook","main_task_local_reference":{"kind":"app_task","name":"0c7134af_dag"},"variable_list":[]},"name":"Configure Base User"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get Initial Authorization Password"},{"kind":"app_task","name":"Install Jenkins CLI"},{"kind":"app_task","name":"Install Plugins"},{"kind":"app_task","name":"Create Jenkins Credential"},{"kind":"app_task","name":"Create Prism Central Credential"},{"kind":"app_task","name":"Create Nexus Credential"}],"name":"d917d896_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Create Jenkins Credential"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Prism Central Credential"}},{"from_task_reference":{"kind":"app_task","name":"Get Initial Authorization Password"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"}},{"from_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Plugins"}},{"from_task_reference":{"kind":"app_task","name":"Install Plugins"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Jenkins Credential"}},{"from_task_reference":{"kind":"app_task","name":"Create Prism Central Credential"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Nexus Credential"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Initial Authorization Password","attrs":{"exit_status":[],"script":"echo \"-------------------------\"\necho \"\"\necho \"Initial Authorization Password:\"\necho $(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)\necho \"\"\necho \"-------------------------\"\necho \"jenkins_authorization=\"$(sudo cat \/var\/lib\/jenkins\/secrets\/initialAdminPassword)\necho \"\"\n","eval_variables":["jenkins_authorization"],"eval_scope":"local","script_type":"sh","type":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins CLI","attrs":{"exit_status":[],"script":"echo \"Install Jenkins CLI\"\n\nwhile true ; do\n  sudo wget http:\/\/@@{address}@@:8080\/jnlpJars\/jenkins-cli.jar\n  if [ $? -eq 0 ]; then\n    break\n  else\n    sleep 60\n  fi\ndone\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Plugins","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -x\n\necho \"Install Jenkins Plugins\"\necho \"http:\/\/@@{address}@@:8080\"\necho \"admin:@@{jenkins_authorization}@@\"\n\nwget -O \/tmp\/pam-auth.hpi http:\/\/updates.jenkins-ci.org\/download\/plugins\/pam-auth\/1.4\/pam-auth.hpi\nsudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 install-plugin -deploy file:\/\/\/tmp\/pam-auth.hpi -restart\n\nwhile true ; do\n  #sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 install-plugin -deploy authentication-tokens script-security bouncycastle-api http_request jackson2-api jquery-detached jsch ldap mapdb-api momentjs pam-auth nutanix-calm credentials plain-credentials resource-disposer scm-api ssh-credentials ssh-slaves structs subversion timestamper token-macro workflow-api workflow-basic-steps workflow-cps workflow-durable-task-step workflow-job workflow-multibranch workflow-scm-step workflow-step-api workflow-support workflow-aggregator credentials-binding git git-client git-server swarm cloudbees-folder cloudbees-credentials -restart\n  sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 install-plugin -deploy authentication-tokens script-security bouncycastle-api trilead-api http_request jackson2-api jquery-detached jsch ldap mapdb-api momentjs nutanix-calm credentials plain-credentials resource-disposer scm-api ssh-credentials ssh-slaves structs subversion timestamper token-macro workflow-api workflow-basic-steps workflow-cps workflow-durable-task-step workflow-job workflow-multibranch workflow-scm-step workflow-step-api workflow-support workflow-aggregator credentials-binding git git-client git-server swarm cloudbees-folder cloudbees-credentials nexus-artifact-uploader pipeline-utility-steps -restart\n  if [ $? -eq 0 ]; then\n    break\n  else\n    sleep 60\n  fi\ndone\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Jenkins Credential","attrs":{"exit_status":[],"script":"echo 'Wait for Jenkins Instance Restart'\nsleep 60\n\necho 'Create Jenkins Credential'\nJENKINS_SSH_KEY=$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa)\n\necho '<com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey plugin=\"ssh-credentials@1.13\">\n  <scope>GLOBAL<\/scope>\n  <id>Jenkins<\/id>\n  <description><\/description>\n  <username>jenkins<\/username>\n  <privateKeySource class=\"com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey$DirectEntryPrivateKeySource\">\n    <privateKey>@@{Nutanix Key.secret}@@<\/privateKey>\n  <\/privateKeySource>\n<\/com.cloudbees.jenkins.plugins.sshcredentials.impl.BasicSSHUserPrivateKey>' | sudo java -jar jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Prism Central Credential","attrs":{"exit_status":[],"script":"echo \"Creating Prism Central User credential\"\necho '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>\n  <scope>GLOBAL<\/scope>\n  <id>PC-User<\/id>\n  <description>Prism Central User<\/description>\n  <username>@@{Prism Central User.username}@@<\/username>\n  <password>@@{Prism Central User.secret}@@<\/password>\n<\/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' | sudo java -jar \/home\/nutanix\/jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _ \n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Nexus Credential","attrs":{"exit_status":[],"script":"echo \"Creating Nexus User credential\"\necho '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>\n  <scope>GLOBAL<\/scope>\n  <id>nexus-user-credentials<\/id>\n  <description>Login Details to Nexus Repository Manager<\/description>\n  <username>@@{Nexus Jenkins Credential.username}@@<\/username>\n  <password>@@{Nexus Jenkins Credential.secret}@@<\/password>\n<\/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' | sudo java -jar \/home\/nutanix\/jenkins-cli.jar -auth admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080 create-credentials-by-xml system::system::jenkins _ \n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4709f4a9_runbook","main_task_local_reference":{"kind":"app_task","name":"d917d896_dag"},"variable_list":[]},"name":"Configure Jenkins Master"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Hook"}],"name":"660dda49_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Hook","attrs":{"exit_status":[],"script":"echo 'StrictHostKeyChecking no' > ~\/.ssh\/config\necho \"Create Hook in Workstation\"\nssh @@{Gitolite.address}@@ 'pwd'\nssh @@{Gitolite.address}@@ 'printf \"\/usr\/bin\/curl --user admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080\/job\/@@{initial_project_name}@@\/buildWithParameters?token=ThisIsTheAPITokenToUse\\n\" | sudo su -c \"tee ~\/repositories\/@@{initial_project_name}@@.git\/hooks\/post-receive\" - git'\nssh @@{Gitolite.address}@@ 'sudo su -c \"chmod 775 ~\/repositories\/@@{initial_project_name}@@.git\/hooks\/post-receive\" - git'\necho \"Complete Hook in Workstatation\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6f9a7f95_runbook","main_task_local_reference":{"kind":"app_task","name":"660dda49_dag"},"variable_list":[]},"name":"Create Git Hook"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"}],"name":"44ac4cf6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get APP Blueprint and Profile UUID","attrs":{"exit_status":[],"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\npcip = \"@@{pc_instance_ip}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/\" + pcip + \":9440\/api\/nutanix\/v3\/blueprints\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\npayload = {\"filter\": \"name==@@{initial_app_deploy_blueprint}@@\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\napp_deploy_blueprint_uuid = r.json()['entities'][0]['status']['uuid']\nprint \"App Blueprint UUID: \" + app_deploy_blueprint_uuid\n\n#bp_uuid = ''\n#for entity in r.json()['entities']:\n#    if entity['status']['name'] == \"@@{initial_app_deploy_blueprint}@@\":\n#        bp_uuid = entity['status']['uuid']\n\nurl_method = 'GET'\nurl = \"https:\/\/\" + pcip + \":9440\/api\/nutanix\/v3\/blueprints\/\" + app_deploy_blueprint_uuid\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\nfor profile in r.json()['spec']['resources']['app_profile_list']:\n    if profile['name'] == 'Default':\n        app_profile_uuid = profile['uuid']\n       \nprint \"App Profile UUID: \" + app_profile_uuid\n\nprint \"app_deploy_blueprint_uuid=\", app_deploy_blueprint_uuid\nprint \"app_profile_uuid=\", app_profile_uuid\n","eval_variables":["app_deploy_blueprint_uuid","app_profile_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"d2950798_runbook","main_task_local_reference":{"kind":"app_task","name":"44ac4cf6_dag"},"variable_list":[]},"name":"Get Blueprint Details"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Create Initial Config"}],"name":"5e34fed4_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Initial Config","attrs":{"exit_status":[],"script":"echo 'Update Jenkins Configuration'\nsudo su -c \"sed -i 's\/<installStateName>NEW<\/<installStateName>RUNNING<\/' ~\/config.xml\" - jenkins\nsudo su -c \"sed -i 's\/numExecutors>2<\/numExecutors>0<\/' ~\/config.xml\" - jenkins\n\necho 'Create Location Configuration'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<jenkins.model.JenkinsLocationConfiguration>\n  <jenkinsUrl>http:\/\/@@{address}@@:8080\/<\/jenkinsUrl>\n<\/jenkins.model.JenkinsLocationConfiguration>\" | sudo su -c 'tee ~\/jenkins.model.JenkinsLocationConfiguration.xml' - jenkins\n\necho 'Set State and Version Configurations'\nsudo cat \/var\/lib\/jenkins.install.UpgradeWizard.state | sudo su -c 'tee ~\/jenkins.install.InstallUtil.lastExecVersion' - jenkins\n\necho 'Configure SSH'\nprintf \"<?xml version='1.1' encoding='UTF-8'?>\n<org.jenkinsci.main.modules.sshd.SSHD>\n  <port>22<\/port>\n<\/org.jenkinsci.main.modules.sshd.SSHD>\" | sudo su -c 'tee ~\/org.jenkinsci.main.modules.sshd.SSHD.xml' - jenkins\n\necho 'Create @@{initial_project_name}@@ Pipeline'\nsudo su -c 'mkdir -p ~\/jobs\/@@{initial_project_name}@@\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{initial_project_name}@@\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{initial_project_name}@@\/nextBuildNumber' - jenkins\n\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY_USER<\/name>\n          <description><\/description>\n          <defaultValue>@@{Nexus Jenkins Credential.username}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.PasswordParameterDefinition>\n          <name>DOCKER_REGISTRY_PASSWORD<\/name>\n          <description><\/description>\n          <defaultValue>@@{Nexus Jenkins Credential.secret}@@<\/defaultValue>\n        <\/hudson.model.PasswordParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Nexus_vmname}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_PORT<\/name>\n          <description><\/description>\n          <defaultValue>@@{Nexus_Repo_Port}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{initial_project_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git@3.9.1\">\n      <configVersion>2<\/configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{initial_project_name}@@.git<\/url>\n          <credentialsId>Jenkins<\/credentialsId>\n        <\/hudson.plugins.git.UserRemoteConfig>\n      <\/userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*\/master<\/name>\n        <\/hudson.plugins.git.BranchSpec>\n      <\/branches>\n      <doGenerateSubmoduleConfigurations>false<\/doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"list\"\/>\n      <extensions\/>\n    <\/scm>\n    <scriptPath>Jenkinsfile<\/scriptPath>\n    <lightweight>true<\/lightweight>\n  <\/definition>\n  <triggers\/>\n  <authToken>ThisIsTheAPITokenToUse<\/authToken>\n  <disabled>false<\/disabled>\n<\/flow-definition>' | sudo su -c 'tee ~\/jobs\/@@{initial_project_name}@@\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@\/builds\/legacyIds' - jenkins\n\necho 'Setup Script Approvals'\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<scriptApproval plugin=\"script-security@1.44\">\n  <approvedScriptHashes\/>\n  <approvedSignatures>\n    <string>method groovy.json.JsonSlurperClassic parseText java.lang.String<\/string>\n    <string>method java.util.Map remove java.lang.Object<\/string>\n    <string>new groovy.json.JsonSlurperClassic<\/string>\n    <string>new java.util.HashMap java.util.Map<\/string>\n  <\/approvedSignatures>\n  <aclApprovedSignatures\/>\n  <approvedClasspathEntries\/>\n  <pendingScripts\/>\n  <pendingSignatures\/>\n  <pendingClasspathEntries\/>\n<\/scriptApproval>' | sudo su -c 'tee ~\/scriptApproval.xml' - jenkins\n\necho \"Create @@{initial_project_name}@@ App Deploy Job\"\nsudo su -c 'mkdir -p ~\/jobs\/@@{initial_project_name}@@_deploy\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{initial_project_name}@@_deploy\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{initial_project_name}@@_deploy\/nextBuildNumber' - jenkins\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>NEXUS_IP<\/name>\n          <description><\/description>\n          <defaultValue>@@{Nexus_vmname}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>BUILD_NUMBER<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <script>import groovy.json.JsonSlurperClassic\nimport groovy.json.JsonOutput\n\nnode() {\n    stage(&apos;Deploy Application Via Calm&apos;){\n        echo &quot;Application deployment visual&quot;\n    }\n}\n\ndef response = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: false, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;]], ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@&apos;\n\nprintln(&quot;Status: &quot; + response.status)\n\/\/println(&quot;Content: &quot; + response.content)\n\ndef blueprint_spec = parseJSON(response.content)\ndef bp_index = 0\ndef var_index = 0\nblueprint_spec.remove(&apos;status&apos;)\nblueprint_spec[&apos;spec&apos;].remove(&apos;name&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;application_name&apos;] = REPO_NAME + &apos;@@{calm_random}@@Jenkins&apos; + BUILD_NUMBER.toString()\nblueprint_spec[&apos;spec&apos;][&apos;app_profile_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;app_profile&quot;, &quot;uuid&quot;: &quot;@@{app_profile_uuid}@@&quot;}&apos;)\nblueprint_spec[&apos;metadata&apos;][&apos;owner_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;user&quot;, &quot;uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;name&quot;: &quot;admin&quot;}&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;].each  { profileKey, profileRow -&gt; \n    println(&quot;Profile: ${profileKey}&quot;); \n    profileKey[&apos;variable_list&apos;].each { variableKey, variableRow -&gt;\n        println(&quot;Variable: ${variableKey}&quot;); \n        if (variableKey[&apos;name&apos;] == &apos;build_number&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = BUILD_NUMBER.toString()\n        } else if (variableKey[&apos;name&apos;] == &apos;project_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = REPO_NAME\n        } else if (variableKey[&apos;name&apos;] == &apos;artifactory_ip&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = ARTIFACTORY_IP\n        }\n        var_index += 1;\n    }; \n    bp_index += 1;\n}\n\/\/println(&quot;Content: &quot; + blueprint_spec)\n\ndef payload = JsonOutput.toJson(blueprint_spec)\nprintln(&quot;Payload: &quot; + payload)\n\ndef result = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: true, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;], [maskValue: false, name: &apos;Accept&apos;, value: &apos;application\/json&apos;]], httpMode: &apos;POST&apos;, requestBody: payload, ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@\/launch&apos;\nprintln(&quot;Status: &quot; + response.status)\nprintln(&quot;Content: &quot; + response.content)\n\ndef parseJSON(json) {\n    return new groovy.json.JsonSlurperClassic().parseText(json)\n}\n<\/script>\n    <sandbox>true<\/sandbox>\n  <\/definition>\n  <triggers\/>\n  <disabled>false<\/disabled>\n<\/flow-definition>'  | sudo su -c 'tee ~\/jobs\/@@{initial_project_name}@@_deploy\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{initial_project_name}@@_deploy\/builds\/legacyIds' - jenkins\n\necho \"@@{Nexus.address}@@ @@{Nexus_vmname}@@.@@{domain_name}@@ @@{Nexus_vmname}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a7f09fc6_runbook","main_task_local_reference":{"kind":"app_task","name":"5e34fed4_dag"},"variable_list":[]},"name":"Initial Jenkins Config"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Jenkins Master"},{"kind":"app_task","name":"Install GIT"},{"kind":"app_task","name":"Install Maven"}],"name":"f813c237_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Jenkins Master"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install GIT"}},{"from_task_reference":{"kind":"app_task","name":"Install GIT"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Maven"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins Master","attrs":{"exit_status":[],"script":"set -x\n#wget -q -O - https:\/\/pkg.jenkins.io\/debian\/jenkins-ci.org.key | sudo apt-key add -\nwget -q -O - https:\/\/pkg.jenkins.io\/debian\/jenkins.io.key | sudo apt-key add -\n#echo deb https:\/\/pkg.jenkins.io\/debian-stable binary\/ | sudo tee \/etc\/apt\/sources.list.d\/jenkins.list\nsudo sh -c 'echo deb https:\/\/pkg.jenkins.io\/debian binary\/ > \\\n    \/etc\/apt\/sources.list.d\/jenkins.list'\nsudo add-apt-repository -y ppa:apt-fast\/stable\nsudo apt-get update\necho debconf apt-fast\/maxdownloads string 16 | sudo debconf-set-selections\necho debconf apt-fast\/dlflag boolean true | sudo debconf-set-selections\necho debconf apt-fast\/aptmanager string apt-get | sudo debconf-set-selections\nsudo apt-get install -y apt-fast\nsudo apt-get install python2.7 -y\nsudo apt-get install default-jre -y\nsudo apt-get install jenkins curl -y \nsudo apt-get install make -y\nsudo apt-get install wget -y\nsudo ufw allow 8080\nsudo ufw allow ssh\nsudo ufw status\necho \"alias python=python2.7\" >> ~\/.bashrc\nsudo ln -s \/usr\/bin\/python2.7 \/usr\/bin\/python\n\nexit 0\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install GIT","attrs":{"exit_status":[],"script":"sudo apt install -y git","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Maven","attrs":{"exit_status":[],"script":"sudo apt install -y maven","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4fa5acdd_runbook","main_task_local_reference":{"kind":"app_task","name":"f813c237_dag"},"variable_list":[]},"name":"Jenkins Master Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Setup SSH Jenkins User"}],"name":"2a7f764b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Setup SSH Jenkins User","attrs":{"exit_status":[],"script":"echo \"Create SSH Keys\"\nsudo su -c 'mkdir ~\/.ssh' - jenkins\nsudo su -c 'chmod 700 ~\/.ssh' - jenkins\nsudo su -c 'echo \"@@{Jenkins Key.secret}@@\" > ~\/.ssh\/id_rsa' - jenkins\nsudo su -c 'echo \"@@{jenkins_public_key}@@\" > ~\/.ssh\/id_rsa.pub' - jenkins\nsudo su -c 'chmod 600 ~\/.ssh\/id_rsa*' - jenkins\nsudo su -c 'echo \"set -o vi\" > ~\/.bashrc' - jenkins\nsudo su -c 'echo \"StrictHostKeyChecking no\" > ~\/.ssh\/config' - jenkins\n\necho \"\"\necho \"Get Public Key\"\necho \"jenkins_ssh_key_pub=\"$(sudo cat \/var\/lib\/jenkins\/.ssh\/id_rsa.pub)\n","eval_variables":["jenkins_ssh_key_pub"],"eval_scope":"local","script_type":"sh","type":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"824881bb_runbook","main_task_local_reference":{"kind":"app_task","name":"2a7f764b_dag"},"variable_list":[]},"name":"Jenkins User Config"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Jenkins User Config"},{"kind":"app_task","name":"Initial Jenkins Config"},{"kind":"app_task","name":"Configure Jenkins Master"},{"kind":"app_task","name":"Create Git Hook"}],"name":"1e33d0f4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Jenkins Master"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Git Hook"}},{"from_task_reference":{"kind":"app_task","name":"Initial Jenkins Config"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Master"}},{"from_task_reference":{"kind":"app_task","name":"Jenkins User Config"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Initial Jenkins Config"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins User Config","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"824881bb_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initial Jenkins Config","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a7f09fc6_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Master","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4709f4a9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Git Hook","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6f9a7f95_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"e3fc86ab_runbook","main_task_local_reference":{"kind":"app_task","name":"1e33d0f4_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2d5a6005_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a8778ba5_runbook","main_task_local_reference":{"kind":"app_task","name":"2d5a6005_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ee069ba2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"47d11a43_runbook","main_task_local_reference":{"kind":"app_task","name":"ee069ba2_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c4c94a95_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d051fa61_runbook","main_task_local_reference":{"kind":"app_task","name":"c4c94a95_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1a27c33e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9df54ae2_runbook","main_task_local_reference":{"kind":"app_task","name":"1a27c33e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Update Installed OS Packages"},{"kind":"app_task","name":"Join DNS"},{"kind":"app_task","name":"Configure Package"},{"kind":"app_task","name":"Join AD Domain"}],"name":"ec81e0e1_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Update Installed OS Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join DNS"}},{"from_task_reference":{"kind":"app_task","name":"Join DNS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Package"}},{"from_task_reference":{"kind":"app_task","name":"Configure Package"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Update Installed OS Packages","attrs":{"exit_status":[],"script":"sudo tee -a \/etc\/apt\/sources.list <<EOF\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic universe\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic-updates universe\nEOF\n\necho \"List out source repositories to update\"\ngrep -i \"^deb\" \/etc\/apt\/sources.list\n\nsudo apt update -y\nsudo apt upgrade -y\n\n#Cleaning up unwanted package\nsudo apt autoremove -y","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join DNS","attrs":{"exit_status":[],"script":"NODE_HOST=@@{name}@@.@@{domain_name}@@\nexport NODE_HOST\necho $NODE_HOST\n\nsudo hostnamectl set-hostname --static $NODE_HOST\n\necho \"# Added entries\" | sudo tee -a \/etc\/hosts\necho \"@@{address}@@ @@{name}@@.@@{domain_name}@@ @@{name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Domain_Server_IP}@@ @@{Domain_Server}@@.@@{domain_name}@@ @@{Domain_Server}@@\" | sudo tee -a \/etc\/hosts\n\necho \"search @@{domain_name}@@\" | sudo tee \/etc\/resolv.conf\necho \"nameserver @@{Domain_Server_IP}@@\" | sudo tee -a \/etc\/resolv.conf\n\nsudo systemctl disable systemd-resolved\nsudo systemctl stop systemd-resolved\n\n#sudo service resolvconf restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Package","attrs":{"exit_status":[],"script":"sudo apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"script":"echo \"Host File\"\nsudo cat \/etc\/hosts\n\necho \"Discovering the domain\"\nsudo realm discover @@{domain_name}@@\n\necho \"Joining the domain\"\n\npassword=@@{Domain Administrator.secret}@@\n#password=Ntnx@Sg2020\nexport password\n#sudo echo $password | sudo \/usr\/sbin\/realm join @@{DOMAIN_NAME}@@  -U Administrator --os-name=\"`uname -o`\" --os-version=\"`uname -rsv`\" --verbose \nsudo echo $password | sudo realm join -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose \n\necho \"List the domain after joining\"\n\nsudo \/usr\/sbin\/realm list\n\necho \"Permitting all users\"\nsudo realm permit --all\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3725ffdc_runbook","main_task_local_reference":{"kind":"app_task","name":"ec81e0e1_dag"},"variable_list":[]},"name":"Join AD Domain"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"627ea1a0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"exit_status":[],"script":"password=@@{Domain Administrator.secret}@@\nexport password\n\necho \"Leaving Active Directory Domain\"\nsudo echo $password | sudo realm leave -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose\nsudo realm list","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4bb74962_runbook","main_task_local_reference":{"kind":"app_task","name":"627ea1a0_dag"},"variable_list":[]},"name":"Unjoin AD Domain"}],"depends_on_list":[{"kind":"app_service","name":"Gitolite"}],"name":"Jenkins Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"app_deploy_blueprint_uuid","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"app_profile_uuid","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"jenkins_authorization","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"jenkins_ssh_key_pub","value":"","label":"","attrs":{"type":""},"is_hidden":false}],"description":""},{"singleton":false,"action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Load Cert"}],"name":"105113e0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Load Cert","attrs":{"exit_status":[],"script":"set -x\n\nmkdir ~\/.ssh\nchmod 700 ~\/.ssh\necho @@{Nutanix Key.secret}@@ > ~\/.ssh\/id_rsa\nchmod 600 ~\/.ssh\/id_rsa\necho @@{nutanix_public_key}@@ > ~\/.ssh\/id_rsa.pub\nchmod 600 ~\/.ssh\/id_rsa.pub\necho \"Installing SSH Pass\"\nsudo apt install -y sshpass\necho \"Make directory to store Nexus certificate\"\nsudo mkdir \/etc\/docker\/certs.d\ncd \/etc\/docker\/certs.d\nsudo mkdir @@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus.Nexus_Repo_Port}@@\n\n#REGISTRY_IP=@@{Docker Registry.address}@@\nREGISTRY_IP=@@{Nexus_vmname}@@.@@{domain_name}@@\nsshpass -p @@{Ubuntu Credential.secret}@@ scp -oStrictHostKeyChecking=no centos@${REGISTRY_IP}:~\/nexus_server.pem \/tmp\nsudo mv \/tmp\/nexus_server.pem \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\ncd \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\nsudo mv nexus_server.pem nexus_server.crt\n\necho \"Verify Nexus certificate\"\n\nsudo ls -la \/etc\/docker\/certs.d\/@@{Nexus_vmname}@@.@@{domain_name}@@:@@{Nexus_Repo_Port}@@\n\necho \"Update CA Certificate and Restart Nexus to trust the certificate\"\nsudo update-ca-certificates\nsudo service docker restart\necho \"@@{Nexus.address}@@ @@{Nexus_vmname}@@.@@{domain_name}@@ @@{Nexus_vmname}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Docker Registry.address}@@ @@{Docker Registry.name}@@.@@{domain_name}@@ @@{Docker Registry.name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Gitolite.address}@@ @@{Gitolite.name}@@.@@{domain_name}@@ @@{Gitolite.name}@@\" | sudo tee -a \/etc\/hosts\n#echo \"@@{Artifactory.address}@@ artifactory.@@{domain_name}@@ artifactory\" | sudo tee -a \/etc\/hosts\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f8bc367a_runbook","main_task_local_reference":{"kind":"app_task","name":"105113e0_dag"},"variable_list":[]},"name":"Configure Connectivity"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Jenkins CLI"},{"kind":"app_task","name":"Configure Jenkins Slave"},{"kind":"app_task","name":"Configure app requsites"}],"name":"19e541c4_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Jenkins CLI"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"}},{"from_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure app requsites"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Jenkins CLI","attrs":{"exit_status":[],"script":"#Download jenkins-cli\nsudo apt-get -y install wget\n\nsleep 30\n\nsudo wget http:\/\/@@{Jenkins Master.address}@@:8080\/jnlpJars\/jenkins-cli.jar\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Slave","attrs":{"exit_status":[],"script":"JENKINS_URL=http:\/\/@@{Jenkins Master.address}@@:8080\nNODE_NAME=@@{name}@@\nNODE_IP=@@{address}@@\nNODE_SLAVE_HOME='\/home\/nutanix'\nEXECUTORS=1\nSSH_PORT=22\nCRED_ID=Jenkins-Slave\nLABELS=build\nUSERID=admin\n\necho \"Creating credential\"\necho '<com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>\n  <scope>GLOBAL<\/scope>\n  <id>Jenkins-Slave<\/id>\n  <description>Slave Login<\/description>\n  <username>@@{Ubuntu Credential.username}@@<\/username>\n  <password>@@{Ubuntu Credential.secret}@@<\/password>\n<\/com.cloudbees.plugins.credentials.impl.UsernamePasswordCredentialsImpl>' | sudo java -jar \/home\/nutanix\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s http:\/\/@@{Jenkins Master.address}@@:8080  create-credentials-by-xml system::system::jenkins _ \n\necho \"Creating slave node\"\ncat <<EOF | sudo java -jar ${NODE_SLAVE_HOME}\/jenkins-cli.jar -auth admin:@@{Jenkins Master.jenkins_authorization}@@ -s ${JENKINS_URL} create-node ${NODE_NAME}\n<slave>\n  <name>${NODE_NAME}<\/name>\n  <description>Jenkins Slave Node<\/description>\n  <remoteFS>${NODE_SLAVE_HOME}<\/remoteFS>\n  <numExecutors>${EXECUTORS}<\/numExecutors>\n  <mode>NORMAL<\/mode>\n  <launcher class=\"hudson.plugins.sshslaves.SSHLauncher\" plugin=\"ssh-slaves\">\n    <host>${NODE_IP}<\/host>\n    <port>${SSH_PORT}<\/port>\n    <credentialsId>${CRED_ID}<\/credentialsId>\n    <maxNumRetries>0<\/maxNumRetries>\n    <retryWaitTime>0<\/retryWaitTime>\n    <sshHostKeyVerificationStrategy class=\"hudson.plugins.sshslaves.verifiers.NonVerifyingKeyVerificationStrategy\"\/>\n  <\/launcher>\n  <label>${LABELS}<\/label>\n  <nodeProperties\/>\n<\/slave>\nEOF","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure app requsites","attrs":{"exit_status":[],"script":"sudo apt install -y make","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6d2cd303_runbook","main_task_local_reference":{"kind":"app_task","name":"19e541c4_dag"},"variable_list":[]},"name":"Configure Jenkins Slave"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Docker"},{"kind":"app_task","name":"Install Docker Compose"}],"name":"8f42cde8_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Docker"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker Compose"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"exit_status":[],"script":"sudo apt install -y curl\n\nsudo apt-get -y remove docker docker-engine docker.io containerd runc\n\necho \"** Downloading Docker Repo Key...\"\ncurl -fsSL https:\/\/download.docker.com\/linux\/ubuntu\/gpg | sudo apt-key add -\n\necho \"** Adding Docker Repo...\"\nsudo add-apt-repository \"deb [arch=amd64] https:\/\/download.docker.com\/linux\/ubuntu $(lsb_release -cs) stable\"\n\necho \"** Apt Update...\"\nsudo apt-get install -y sshpass\n\necho \"** Set apt-cache policy for docker-ce...\"\napt-cache policy docker-ce\n\necho \"** Installing Docker CE...\"\nsudo apt-get install -y docker-ce docker-ce-cli containerd.io\n\necho \"** Adding current user to docker group...\"\nsudo usermod -aG docker @@{Ubuntu Credential.username}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker Compose","attrs":{"exit_status":[],"script":"#sudo apt-get -y install python-pip\n#sudo pip install --upgrade pip\n#sudo pip install docker-compose\n\nsudo curl -L \"https:\/\/github.com\/docker\/compose\/releases\/download\/1.28.2\/docker-compose-$(uname -s)-$(uname -m)\" -o \/usr\/local\/bin\/docker-compose\nsudo chmod +x \/usr\/local\/bin\/docker-compose\ndocker-compose --version","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"eb6bcfac_runbook","main_task_local_reference":{"kind":"app_task","name":"8f42cde8_dag"},"variable_list":[]},"name":"Docker Installation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Java"}],"name":"20cf7e99_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Java","attrs":{"exit_status":[],"script":"sudo apt-get install default-jre -y\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c8435ece_runbook","main_task_local_reference":{"kind":"app_task","name":"20cf7e99_dag"},"variable_list":[]},"name":"Java Installation"},{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Configure Connectivity"},{"kind":"app_task","name":"Configure Jenkins Slave"}],"name":"ae5e6af0_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Connectivity"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Jenkins Slave"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Connectivity","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"f8bc367a_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Jenkins Slave","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"6d2cd303_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"af3d1fe3_runbook","main_task_local_reference":{"kind":"app_task","name":"ae5e6af0_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e92443c7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"555be4c9_runbook","main_task_local_reference":{"kind":"app_task","name":"e92443c7_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"00c19b6d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"04de4a48_runbook","main_task_local_reference":{"kind":"app_task","name":"00c19b6d_dag"},"variable_list":[]},"name":"action_restart"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"117602e2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ccc2a1d7_runbook","main_task_local_reference":{"kind":"app_task","name":"117602e2_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"6e79884f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d6f485c8_runbook","main_task_local_reference":{"kind":"app_task","name":"6e79884f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Update Installed OS Packages"},{"kind":"app_task","name":"Join DNS"},{"kind":"app_task","name":"Configure Package"},{"kind":"app_task","name":"Join AD Domain"}],"name":"ff8ac73e_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Update Installed OS Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join DNS"}},{"from_task_reference":{"kind":"app_task","name":"Join DNS"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Package"}},{"from_task_reference":{"kind":"app_task","name":"Configure Package"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Join AD Domain"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Update Installed OS Packages","attrs":{"exit_status":[],"script":"sudo tee -a \/etc\/apt\/sources.list <<EOF\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic universe\ndeb http:\/\/us.archive.ubuntu.com\/ubuntu\/ bionic-updates universe\nEOF\n\necho \"List out source repositories to update\"\ngrep -i \"^deb\" \/etc\/apt\/sources.list\n\nsudo apt update -y\nsudo apt upgrade -y\n\n#Cleaning up unwanted package\nsudo apt autoremove -y","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join DNS","attrs":{"exit_status":[],"script":"NODE_HOST=@@{name}@@.@@{domain_name}@@\nexport NODE_HOST\necho $NODE_HOST\n\nsudo hostnamectl set-hostname --static $NODE_HOST\n\necho \"# Added entries\" | sudo tee -a \/etc\/hosts\necho \"@@{address}@@ @@{name}@@.@@{domain_name}@@ @@{name}@@\" | sudo tee -a \/etc\/hosts\necho \"@@{Domain_Server_IP}@@ @@{Domain_Server}@@.@@{domain_name}@@ @@{Domain_Server}@@\" | sudo tee -a \/etc\/hosts\n\necho \"search @@{domain_name}@@\" | sudo tee \/etc\/resolv.conf\necho \"nameserver @@{Domain_Server_IP}@@\" | sudo tee -a \/etc\/resolv.conf\n\nsudo systemctl disable systemd-resolved\nsudo systemctl stop systemd-resolved\n\n#sudo service resolvconf restart","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Package","attrs":{"exit_status":[],"script":"#sudo apt update -y\nsudo apt -y install realmd libnss-sss libpam-sss sssd sssd-tools adcli samba-common-bin oddjob oddjob-mkhomedir packagekit","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"exit_status":[],"script":"echo \"Host File\"\nsudo cat \/etc\/hosts\n\necho \"Discovering the domain\"\nsudo realm discover @@{domain_name}@@\n\necho \"Joining the domain\"\n\npassword=@@{Domain Administrator.secret}@@\n#password=Ntnx@Sg2020\nexport password\n#sudo echo $password | sudo \/usr\/sbin\/realm join @@{DOMAIN_NAME}@@  -U Administrator --os-name=\"`uname -o`\" --os-version=\"`uname -rsv`\" --verbose \nsudo echo $password | sudo realm join -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose \n\necho \"List the domain after joining\"\n\nsudo \/usr\/sbin\/realm list\n\necho \"Permitting all users\"\nsudo realm permit --all\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4755a243_runbook","main_task_local_reference":{"kind":"app_task","name":"ff8ac73e_dag"},"variable_list":[]},"name":"Join AD Domain"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"05b1ec4e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"exit_status":[],"script":"password=@@{Domain Administrator.secret}@@\nexport password\n\necho \"Leaving Active Directory Domain\"\nsudo echo $password | sudo realm leave -U @@{Domain Administrator.username}@@ @@{domain_name}@@ --verbose\nsudo realm list","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0db9fbf9_runbook","main_task_local_reference":{"kind":"app_task","name":"05b1ec4e_dag"},"variable_list":[]},"name":"Unjoin AD Domain"}],"depends_on_list":[{"kind":"app_service","name":"Jenkins Master"}],"name":"Jenkins Slave","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nexus"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2bbc5158_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7ad02a6f_runbook","main_task_local_reference":{"kind":"app_task","name":"2bbc5158_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nexus"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a532d290_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0a057e6f_runbook","main_task_local_reference":{"kind":"app_task","name":"a532d290_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nexus"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"71c1ccc6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e716ee00_runbook","main_task_local_reference":{"kind":"app_task","name":"71c1ccc6_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nexus"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"795db58e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bfd07951_runbook","main_task_local_reference":{"kind":"app_task","name":"795db58e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Nexus"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3e6b50cb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ef625c1_runbook","main_task_local_reference":{"kind":"app_task","name":"3e6b50cb_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Nexus","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GitoliteVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"37c05177_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"20a740d4_runbook","main_task_local_reference":{"kind":"app_task","name":"37c05177_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GitoliteVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"215dc168_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b5f142db_runbook","main_task_local_reference":{"kind":"app_task","name":"215dc168_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"GitoliteVM","readiness_probe":{"connection_type":"SSH","retries":"10","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"g@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"60c43bc7-f0ce-4e2c-ad65-7c4a55949cd3"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"64cc2aef-abbc-4a94-89c6-23aa52cb90b6","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"ubuntu-20-04-no-prompt-ad.qcow2","uuid":"772b4366-559c-499b-8eb4-823c0edac663"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsMasterVM","readiness_probe":{"connection_type":"SSH","retries":"10","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"m@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"60c43bc7-f0ce-4e2c-ad65-7c4a55949cd3"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"64cc2aef-abbc-4a94-89c6-23aa52cb90b6","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"ubuntu-20-04-no-prompt-ad.qcow2","uuid":"772b4366-559c-499b-8eb4-823c0edac663"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"JenkinsSlaveVM","readiness_probe":{"connection_type":"SSH","retries":"10","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"@@{calm_time}@@@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"60c43bc7-f0ce-4e2c-ad65-7c4a55949cd3"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":6,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"64cc2aef-abbc-4a94-89c6-23aa52cb90b6","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"ubuntu-20-04-no-prompt-ad.qcow2","uuid":"772b4366-559c-499b-8eb4-823c0edac663"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"WorkstationVM","readiness_probe":{"connection_type":"SSH","retries":"10","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"w@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"60c43bc7-f0ce-4e2c-ad65-7c4a55949cd3"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nfqdn: @@{name}@@.@@{domain_name}@@\nmanage_etc_hosts: true\nhostname: @@{name}@@"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"64cc2aef-abbc-4a94-89c6-23aa52cb90b6","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"ubuntu-20-04-no-prompt-ad.qcow2","uuid":"772b4366-559c-499b-8eb4-823c0edac663"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"NexusVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"79bdd170_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2bcfdf1c_runbook","main_task_local_reference":{"kind":"app_task","name":"79bdd170_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"NexusVM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"59216539_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"59710410_runbook","main_task_local_reference":{"kind":"app_task","name":"59216539_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"EXISTING_VM","name":"NexusVM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{ip_address}@@","delay_secs":"60","disable_readiness_probe":true,"login_credential_local_reference":{"kind":"app_credential","name":"Nexus Credential"}},"os_type":"Linux","create_spec":{"type":"PROVISION_EXISTING_MACHINE","address":"10.42.94.106"},"variable_list":[]}],"credential_definition_list":[{"username":"jenkins","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"joa4gKhC7XwvnunernZZNxR9BmhauuQxU2Ck+YDdyQXD0sQ\/WATt1hjhahj\/luEVlBRPtstxodSJcZgOwJ3FgobEq8Gutp7+NEePVI6GM5AtAA5TT\/ScTYZS975n9MLrKovaXzXOGzjfqcujpvlL8j+SfYaComRSZDW9FLVcaV3nJNdpLCg1i\/4FcpO7P\/GmUAocC+NWkh4tCZ8xfX\/w0hHMQgT1yM4I3ro4QVSvvh9932vxuE+\/Hsgr+l+c\/t2JRlol\/g5faXfSyE9tPbts\/mxd5IdzDAz6sVyj2xWUc1CCFJbe9xcyw\/P8aKdGSPUrL+a51UQ1KTkPZrk+v3uI5VrCslst1v4JY4HO3NEoeMS\/+DRcdEN1\/YsxTSCuYI6Gf3+lK2qfyP4vpAtsTCvumLyi+y\/w0WPLywn9uC1vNXfP5QuhVTjkFFURaKXLfL9+\/VtK2tNeOf2GvXK6l69PPMCHl\/ovXOGw\/gCJ4OQ8KSMtbs56VhC3Z8PJwUJxWS5ryvrU6GNBAkE97LLWI1Saj2o2f492ikFySzKGa9THjlxJGCDSkDVJc3jGc3h8+4aOBeuzVS5x5IcKZy7\/1dAzAyz9kyOTQRNAAhvcTRlwlQ5BtPwUAJl3Bt3D\/nWlhBl6Wv2kAVrAcw8gHIYdNPL5ZqnNpPASAp0dF78c\/T4tfp5axZ9X6tQ5rh4Bf1\/hna9BjBYJaoshaU8TqGZ0KD0djg2K8erDwE1wp6L4dZwWtHB2\/ox7KUzpFtCo5rm63tX32rN3gwVi2T8Tb8X915DprGDFxGjUems39IQSCncGaW1KzjufxaFk\/Cwrs9cfjAmEVpEcR3KlhGzE3cSTe\/Z7O6o6GJ\/DUwSUK\/AicKF3entceavOOxqgUHJS0Ig\/9anR0osZWSm1Zo4uqSRn1apUDNymbJ1r0VwD+Fbp1mOPoK96q\/KvHEdbjWKPb77hvAiecPUmFCg3OCBRH1OlEAdS9tvzqNWPAH5x35Jhe+xoUZTSfCH25xH85xsVo61W1rtgtIiyw87jWGgveaD4tSGirYkxnvidZBEMtFH6gsICfVcp+CznPVTdRkwo5milozfR86afZevw0blrlc9xo7\/vgKg63DZI17e3ZCxQDU9GAUjpMTRTzi\/0CpqCgBe3NrvbbRs6Nt04Ftb4DKkOas01ijS5TASp91QVA5thYDqyaXzvjiIm8gVXgOZP1YN3KrMqoY9ZlfnRwMdJZs2u54mAZbDLjTpnOOOlMbeAIPorTZtz2AX3YIwzYWyvT8Dh4ioZWgEhKVC0c6Saz\/lZoeBIIuehU1GFGydQZYYhyIfQs5l+2kqcMLQSAD8rzqhE1\/eOK9Wvkb+tULwqysk440WhP0OHdZEZ4Mwqkt5UYNGlFZJ4Od5uwLkn8lH1T3\/Em\/viOBqfXmxfRfBCUh04iM5vothgdjvGTA185Zc1WBdlxkd3sxsMiY1BmwobToCWcWj4bqm0o0Uo42X0HaoPsKMJ8cii70sGMgNIkm0qxdWnLs6HTFBXpojpTGlTgcX0TyKVaaeyhhrzf1zQoK\/ByVMco8NCH5nXwoQbNnWHv4GWzqusBSiKZUVj06VfLIfEo7\/WEwweNyv4tGYfe9LKHP5edwLnCxzz18dWVRGVI0w1G\/UBY+DDZm\/5piBPrBZVHflDpTKuYx1TNXo3wCQ+W0qMMs1HWfi1KSLvZrcC4r0CQKFclt0dZrMCbbmrAivlYoXkIVfeEzkye6Y5uGsXwGQLa3ixBQ1CB4rHvAPSToXRub34CWe+nMcEz7MjRkhxq5jvDa\/O9\/JaM4H+bhJSg1nPK\/aU8oDbtgp5ZocEAUi7onohI0KK7AADtgF2xzzOLFJGElzFz5cAmGsQek2qM+FJAGQ1mooV2fgNuHkGWdSdu5vl+KjakFnZVPFmy3VUg\/hcK2CKOFccr2jqPwyWGWLYim0cmsLlVGjVrLHR3qiA\/slJ0VY06hQRYboHyXIrTz4q4vr06W+dhdEhs5XImzsHp29d1E2V\/EU9hvwPZY2lfBsBn0zb93nrPc5nK1LJR6B3ne92CsYVJUPZr8uZw2G9WdtpAHPYiiyMUuhQXFT1rLJg32vnlZlQ9C7atfBekF3mA6\/M4Uxa36\/esl3tFgU\/WXHCXEDou64TA\/5f7toZZwPgLtvm7GsHjyex6mEmQyiPRHO3vNpFh3gg\/A4QWLuarwsRspi\/6H0hFR8E0qBpJK9ha4ZC\/lqqS6oGh0dlBT\/lzocKlvTIAyOgJ6ZPRTUXW6ufAWWfnXLSXDs=:utf-8"},"name":"Jenkins Key","editables":{"username":true,"secret":true}},{"username":"nutanix","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"iZ1fZN7+HczEMXSIfmD+HdYVn+lzycGJngZSQKwHvBBMhKfHaJ1ESL51OrNhkywEBgvb\/NPPrCXZTN786OzWhFsPV9lZLPNXpeg+PMzXIugPmDUUSTxlrhTAWvyrBMluPt+MLSugMFQWjwcCeP4QHDiQox4M\/ZKSW5RmupeR\/d2rPo0bjyyXlo+Rhrrv6ZxkzwPonvQAmRUMHwOe\/QgIh74u9sKivpzORYUh4XTR\/GGo5dq87YCpeUH5xvSXC2tVjr\/VaZgc+QOyC8m3A9bXwOSAsAmBl6ilvgnRv4wk6gBXO3CcmKA1K7xaXhRcfgNDnKe0sS5Zl93k3slEe+l81n0FjjWe2YPv086kVPCHUHjtU3APsnuPe9TW325H6rwI+Yms\/VVWwt6QNEt8jL2V55TnCJSARCiXeukQ6gnrmKDSkhbIP2k3KzPaRZjdIrJrZ0Q89jP+7uLvYRExU+4Oxajem6dPP7tetIPxtyVgAl4F\/UGc\/1oDkfJ6fYoAymf3dfZ\/fjf6\/g32SZALyIdXsCwGRQwlkKkxd\/NbAmhvp0aau4nCn4UtPTY7ZpsB56P6HcyizY1ozyfRaTJSR+LG7pbsA1q7ihpKt1CybkOcCNzI3nttxAm0v9jalh630AQ\/BiLbYhzkr91gk75ADAfGZgsToQ2lR1dP+AklJhJoQZOmKD6YMTGcnN0Tv+ePI1jibT0u5F0ANtULimec1rMgdMUtjqnxtkfkAiJcaP3KxDke81Q2E86zKpulnsBLhgwD1P\/ScY7gpNJOO+I6X\/LlPx74xiBD2C6hgXauWyVwmSHBX9cXTaPrPFSnLUHQWRy2lAh5uCxaAJuZQM+\/awb0m9h0rgzDNIZNdaNhMxS3Noue8TXaVY5Zv+UBIip1VusFmE6se0GmXoWKo3BfPuf14lMDCoKxrpcZNtQxAFi2w\/q4Npz81aXcQ3yz0IxVC2k9sLVBg8tTe\/vrrXcu8frGnE6EKn1lllaCzWA9Ez5IHShaRxC5biVh2PGW7Sa3KETQ2LqeH9nz1VHUgd0TpbRb23w3nVs9NG4DCu56DpstYP5ueQHVSW6wJCslnLYHp3SpXaFd+1S1ZNiC+9HKuRmpJxsV\/QuzIA4gnDjHyBR5ZQHtHnwV0MSH8K3qFqKd3u2vp526gBwhXEtz+WAS86Lc6v30egRyhNNhJ9zoPIPESa17tXC9nB4WXGNOn0PIhbtNjjmEyTPFhl9qIBjHbHbNMFJ+ry4QwYLMchxR5IbJk5iQPcKsq06roxPuQyUpIElmueSOxBM0FHYpdCC\/xqC+R2Zwg1LCZoXPaaXTPbRNfbq2E6NkzXTl+zhNj\/tXqXrzQQIfslfN\/R5uMo9gZM3RKV3iFpr8NJd6xzRZla6YXdcEDorvAznV6NzN0xTOBBojOjfQSYylNJHiqCmP7dwNxBFNSu+xZ+9EpTFQvXmMC+RQcYFcz4G+moe8HebMkvUyCHoo\/kj8VBbdj28M0\/0znoyRWM+CBgyUuLmlku\/gXNv0fWnLbUMzceBMgMQ7zBeNcYQKR\/EOY+dTbsvtpTUbykYYNOSY3anYQpyj6FcZneSh7gXGrHVd7P34vKOf+h32u3HaRFNjnji9VzXeltDIbg3Y7\/W6Fj5OS1UjYbW2TIurxdfm+z+2kOt+9ReCE5Twu08V\/F5pN8DM7BJM\/4\/VBceGU6icWZu0ICBpVKZ\/D3PIvL9i8PDpGEbd6iI5oDYeXvzwFlZu+qUp9zixyE8gc9JgVaHmNgyvQE3CmMPnxlpB1e7hTw6CoONZBzp9qC6XEtBeuSUzOII0RlqEKBCfewvj682gOFToXAsuypp3g+O8289qPNYXxaGGZgcDvb3tA2ieaaTbTSHdWMo1h1Add0ixXvnfH50DsJPOOw2AgQP1xoBxtrgvct2qRBLiTzZCBSqfKMo\/oseOj7oaMdfMUscnBimbmZfkRouzfnti+9y0gLE\/RfqWlOYH3onSJIaD1zo2etlzqIhQqTTH0QPCeqjYnOJSReehCnpECDwsZbxJDOgjUN8nyv+neFCF12NLmTOjINPaWPdubGY9KfaYPqyunI3sw5lRB9dW115\/zVnQhuhBzOeKiOk6yn1fW4slMYiEe4BQfQ\/TIwe1+iIMlFFYYM+lWHSnb2FkDHMXUH0iPjjDKkpbBAheq4SpDruhWtSddMKd4y1\/ZLM6wTyBqfDPxFcgTKLjnnQ4yUslRO6ciUf2K9XqyagbNNTxeMOt\/hRj04JykngcB\/gmKipl5aAMXSrTDBeNjuE=:utf-8"},"name":"Nutanix Key","editables":{"username":true,"secret":true}},{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"G1xNeOTITxNlFaaXEkuq5NxiYykRDQ0GwbbqNKtRAubeSKF\/ERxjIxPm:utf-8"},"name":"Prism Central User","editables":{"username":true,"secret":true}},{"username":"nutanix","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"GmlhSFKFjqwyhCi5uIEfEuGQ9UueWfSdHoUX+hIQnfs2ziNsLHH6NAFV:utf-8"},"name":"Ubuntu Credential","editables":{"username":true,"secret":true}},{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"hL8TmKtI5T6\/gi2+mo2VywMyPb0dKOI0wfLsdc6tjwTMMe356tfLQtsz+E\/ToWeZb9Lax\/jvxGTE20Pw1svhi6ubfq53nWGr+0eEF4LMU48hs2zsLVmgmR5aoqk0X9z6HMR8z7F4F0KiZ46BcCIVjtzaHM7FAcl6ZaTNw6KSBjcFWALOAdQF12eF\/pE\/VYBJn6UkDoc\/L7iJY\/dFV9SsQCOxJDnMshiwMS10BKe\/13T0sckRctVicexSIWsLZlDictiuWt1U48tHamdjnCeSTUttO2iQr3tnTuBfHyMIePioZ0BxfYzmZnt6wYSaQGirHyiBqVCMLYZe04Y0wWuw4Ccd0gopaXpLIRd7eYO8BwtrNYgHQTUBxHYilal\/kVtICZ+QAxYV3mVWAKQ4PRJ9Zj676w1fJ4KOmjSCuiSVfrPEY4HBkPRhDIvnQbPdL23JRRDjp0K3wXiLgCIBiNkMzEvy+Y96YXdRH28aXJ7FXATRUaPAhUkqQRRUncV3Arw+oKLT38ybTksHdLWBS6xBczPquBfjXbuqw8jSEepfNX0TNtrDvZp20svcjdj\/ATpoau7nrh5S+JSauR0+aTbrhvt9CIJXOf4g1M9ttZQOJ5DU0l9VRcmX6e7Sm2bEfRcJzZlgWS1WDP28tA19Rv9oQ10Vy2hrIsBUTa9isdXvW8BNDCJqQH2eTjlG5zLeSyzOUNdWRD1bqFw10tMrJB+iWE7S474jt0d3kxPW8SWFmVlJn4mrt6i2A7FD8wX7dTDbbt3IK6rg5G7WtFubIAJpyn+ogKqZjZZlV1+hqZF6klscN2fcZ0YAUJqkfLIz1lysGL6Dngnv+A92k65h3MtxmMKr+tWO1NM9haPAfEyGtAybOoJC+sKOvw4zFCvcsPn\/qt\/S6L+CYM8DQLS4OquiFu1ERKE0gO2Uvesc5suo5qQsQim9BqB6iKSRiZVV14JPK2zJo3\/XW6\/MYmC5QHHiB5xhpLl0SX\/i3vhbCyvZ1azFTOG7aVf0S6f2GiPavodMJ+AdDnG8P0o0DVbPhVGgGbLNI9Ze2FhUaS2GTpec\/OUCe6jxuDV+otKigQO8r8uR72sJhRTfvewEG3iBtjT\/TvHKZhQHC6V1ls0CdgyNDeHeysFgXQrJ4h5mXkLMnt9eLjAwZhs+2IoM830f6HmTx2I\/XIKVlA4QGNFDBl8pa\/yTt2ZAsLwia8LJLAmHTsYXP1S7qhohh5h9t3cnvDpKExn88dErRAxlLZL8SlZx7nt6Eka\/i2APmQNb+QDQyjLsG+X68TQYhQ8CDvU32Cx84dq4hufMpjqL\/3gRngKO4rosvXS4STPKXnZBfwuY0bwPd\/8BZoUhfKbN6XEQHsG65o2WLtCu1zglEjSQgB4pELv1APyRYNLh3zPWyu0XHd\/MO4jvTUQ7s\/cSZffcx1\/ULvkVedITW13mdxORFIGbujb3AnJHD5qskW6uMrBaH2VCo588Fl\/FQ+KkCBWAuxAfi0491SD1xU4oj2kLWqNsLzWM20fy\/\/QPchLX6jYO296vBuj8ovCbVMNc9LxLmoEnmdaKMTCayfL\/FlgamDn1U9SiAABRe2l6ThemQjLmxa2ViUfaoX8Neivbyq9tDAGx\/54tKICtSuce7SZArWNNdqHBw5WtDot8WvCV1DO36mAmvPztSWgP1lQH3TQzkzvgO+JMOkEVHhxne\/aG9D8+JPhloabAhESzYev2zNFd+saOxHcYpon4UMOmosKQFaIc0cV\/ATE4tXKZOScqFMrl39WPIjBijN66mdpEzYiPf9ilyLjjTdZgZspEK1Xzfw1P0YG+mLG54\/6fyU8plsChqx5vSeOX9wGZr+Syw0vYLOTSQvAjuIKeQJ\/RKhEg0k2K7YBBwP+5HnboD5G2pH2yMHq9NgrM7meSl7DG0vQILNpquIwFwhm7kX43iuBKSOW\/UFQN8c3PhcM0vu77z7R0W2aYGOqrtMcJbXLnfwwKeOtpkKv+1X8X5\/Bf4GycatHXmLucyYNm61fE+l6\/cJgsUNWDSpLtgiktLhDuJkXFjx7OrxZxUYjSQvAqpyNlExUfab7i9Yd865Pc20vbv7i4roYZ+zwb02MNH0+rQUKJxAo4qcYaAmICSi2Y\/J9jrc0S3OkrcfB2RWfby7CPWeV\/Bj69BsWPQEUlX6+t3rMy\/MH46yrqTeV9fE+j+XkHHeuIUQaKBLBrsDfhyK0KG0us5OBbySludP1EeI6twySIw0MRaBibkTzGynJ1kHO2TxNDSID+jgDDBqsMCVM=:utf-8"},"name":"Nexus Credential"},{"username":"mat0606","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"XJBPG3+YVEeedr6DC2Ou8c9kiVO8KMWYOhYEP6cYt1rM8T1VEWM165pZVA==:utf-8"},"name":"Nexus Jenkins Credential"},{"username":"Administrator","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"erRfvQMLxtHy31pQfSJ5viRYFnpgCKKbdrypz9LMlRN7swEYXunPU8rC:utf-8"},"name":"Domain Administrator"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Gitolite"}],"name":"GitolitePackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GitolitePackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"Gitolite Installation"}],"name":"037bb3fc_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Gitolite Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"c39e22fb_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Gitolite Installation","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a89a99a1_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"30a62397_runbook","main_task_local_reference":{"kind":"app_task","name":"037bb3fc_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GitolitePackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"29d1a79f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"c4bb8281_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"e129694b_runbook","main_task_local_reference":{"kind":"app_task","name":"29d1a79f_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Master"}],"name":"JenkinsMasterPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsMasterPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"Jenkins Master Installation"},{"kind":"app_task","name":"Configure Base User"},{"kind":"app_task","name":"Get Blueprint Details"}],"name":"116239e7_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Configure Base User"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Get Blueprint Details"}},{"from_task_reference":{"kind":"app_task","name":"Jenkins Master Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Base User"}},{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Jenkins Master Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"3725ffdc_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Jenkins Master Installation","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4fa5acdd_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Base User","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"7ea304d1_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Blueprint Details","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"d2950798_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"debd6783_runbook","main_task_local_reference":{"kind":"app_task","name":"116239e7_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsMasterPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"75071e5e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4bb74962_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"784076f4_runbook","main_task_local_reference":{"kind":"app_task","name":"75071e5e_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Jenkins Slave"}],"name":"JenkinsSlave Install","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsSlave Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"Docker Installation"},{"kind":"app_task","name":"Java Installation"}],"name":"57ea840c_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Java Installation"}},{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Docker Installation"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"4755a243_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Docker Installation","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"eb6bcfac_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Java Installation","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"c8435ece_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"6423da3d_runbook","main_task_local_reference":{"kind":"app_task","name":"57ea840c_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"JenkinsSlave Install"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"e4a1d78d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"0db9fbf9_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"2b6f43e2_runbook","main_task_local_reference":{"kind":"app_task","name":"e4a1d78d_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Developer Workstation"}],"name":"WorkstationPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WorkstationPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Join AD Domain"},{"kind":"app_task","name":"NodeJS Installation"},{"kind":"app_task","name":"Install Docker"}],"name":"8e7d1b8d_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Join AD Domain"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"NodeJS Installation"}},{"from_task_reference":{"kind":"app_task","name":"NodeJS Installation"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Docker"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Join AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"bda1febd_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"NodeJS Installation","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"ffab2e14_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Docker","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"a79c95b6_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"71d086d7_runbook","main_task_local_reference":{"kind":"app_task","name":"8e7d1b8d_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WorkstationPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Unjoin AD Domain"}],"name":"ae0fc3d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Unjoin AD Domain","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"f9659979_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"3867060f_runbook","main_task_local_reference":{"kind":"app_task","name":"ae0fc3d0_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Nexus"}],"name":"Package5","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package5"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5c122499_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0357f510_runbook","main_task_local_reference":{"kind":"app_task","name":"5c122499_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package5"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"51f10053_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4e98ac46_runbook","main_task_local_reference":{"kind":"app_task","name":"51f10053_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"1afa7711_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"JenkinsMasterPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsMasterVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"8cafc62e_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"5","package_local_reference_list":[{"kind":"app_package","name":"JenkinsSlave Install"}],"substrate_local_reference":{"kind":"app_substrate","name":"JenkinsSlaveVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"aa65c031_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"10","package_local_reference_list":[{"kind":"app_package","name":"WorkstationPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"WorkstationVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"fe95f237_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"GitolitePackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"GitoliteVM"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"5f18b67e_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package5"}],"substrate_local_reference":{"kind":"app_substrate","name":"NexusVM"},"variable_list":[],"description":""}],"environment_reference_list":[],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"},{"kind":"app_task","name":"Initialize Git Repository"},{"kind":"app_task","name":"Configure Project Access"},{"kind":"app_task","name":"Config Jenkins Jobs"},{"kind":"app_task","name":"Initialize Workstation Git Repository"},{"kind":"app_task","name":"Restart Jenkins Service"},{"kind":"app_task","name":"Wait for Restart"},{"kind":"app_task","name":"Download Version 1 Demo Code"},{"kind":"app_task","name":"Create Git Hook"},{"kind":"app_task","name":"Create and Push Docker Images"}],"name":"efbcbb73_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Config Jenkins Jobs"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart Jenkins Service"}},{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Git Hook"}},{"from_task_reference":{"kind":"app_task","name":"Configure Project Access"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Initialize Workstation Git Repository"}},{"from_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create and Push Docker Images"}},{"from_task_reference":{"kind":"app_task","name":"Get APP Blueprint and Profile UUID"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Config Jenkins Jobs"}},{"from_task_reference":{"kind":"app_task","name":"Initialize Git Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure Project Access"}},{"from_task_reference":{"kind":"app_task","name":"Initialize Workstation Git Repository"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Download Version 1 Demo Code"}},{"from_task_reference":{"kind":"app_task","name":"Restart Jenkins Service"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Wait for Restart"}},{"from_task_reference":{"kind":"app_task","name":"Wait for Restart"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Git Hook"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get APP Blueprint and Profile UUID","attrs":{"exit_status":[],"script":"user = \"@@{Prism Central User.username}@@\"\npassword = \"@@{Prism Central User.secret}@@\"\n\ndef process_request(url, method, user, password, headers, payload=None):\n    r = urlreq(url, verb=method, auth=\"BASIC\", user=user, passwd=password, params=payload, verify=False, headers=headers)\n    return r\n\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/list\"\nheaders = {'Accept': 'application\/json', 'Content-Type': 'application\/json'}\nurl_method = \"POST\"\npayload = {\"filter\": \"name==@@{new_app_deploy_blueprint}@@\"}\nr = process_request(url, url_method, user, password, headers, json.dumps(payload))\nprint \"Response Status: \" + str(r.status_code)\nprint \"Response: \", r.json()\napp_deploy_blueprint_uuid = r.json()['entities'][0]['status']['uuid']\nprint \"App Blueprint UUID: \" + app_deploy_blueprint_uuid\n\n#bp_uuid = ''\n#for entity in r.json()['entities']:\n#    if entity['status']['name'] == \"@@{new_app_deploy_blueprint}@@\":\n#        bp_uuid = entity['status']['uuid']\n\nurl_method = 'GET'\nurl = \"https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/\" + app_deploy_blueprint_uuid\nr = process_request(url, url_method, user, password, headers, payload)\nprint \"Response Status: \" + str(r.status_code)\nfor profile in r.json()['spec']['resources']['app_profile_list']:\n    if profile['name'] == 'Default':\n        app_profile_uuid = profile['uuid']\n       \nprint \"App Profile UUID: \" + app_profile_uuid\n\nprint \"app_deploy_blueprint_uuid=\", app_deploy_blueprint_uuid\nprint \"app_profile_uuid=\", app_profile_uuid\n","eval_variables":["app_deploy_blueprint_uuid","app_profile_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize Git Repository","attrs":{"exit_status":[],"script":"echo \"Create and Configure @@{new_project_name}@@ Repository\"\nsudo su -c 'mkdir ~\/repositories\/@@{new_project_name}@@.git' - git\nsudo su -c 'cd ~\/repositories\/@@{new_project_name}@@.git && git init --bare' - git\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Gitolite"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure Project Access","attrs":{"exit_status":[],"script":"echo \"Configure @@{new_project_name}@@ Repository Access\"\necho \"repo @@{new_project_name}@@\" >> ~\/gitolite-admin\/conf\/gitolite.conf\necho \"    RW+     =   @all\" >> ~\/gitolite-admin\/conf\/gitolite.conf \necho \"    R       =   jenkins\" >> ~\/gitolite-admin\/conf\/gitolite.conf \n\necho \"Check IN and Commit Changes\"\ncd gitolite-admin\ngit add conf\/gitolite.conf\ngit commit -m \"Added @@{new_project_name}@@ Repository\"\ngit push origin master","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Config Jenkins Jobs","attrs":{"exit_status":[],"script":"echo 'Create @@{new_project_name}@@ Pipeline'\nsudo su -c 'mkdir -p ~\/jobs\/@@{new_project_name}@@\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{new_project_name}@@\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{new_project_name}@@\/nextBuildNumber' - jenkins\n\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY_USER<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.username}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.PasswordParameterDefinition>\n          <name>DOCKER_REGISTRY_PASSWORD<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry Credential.secret}@@<\/defaultValue>\n        <\/hudson.model.PasswordParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>DOCKER_REGISTRY<\/name>\n          <description><\/description>\n          <defaultValue>@@{Docker Registry.name}@@.@@{domain_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue>@@{new_project_name}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsScmFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <scm class=\"hudson.plugins.git.GitSCM\" plugin=\"git@3.9.1\">\n      <configVersion>2<\/configVersion>\n      <userRemoteConfigs>\n        <hudson.plugins.git.UserRemoteConfig>\n          <url>git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{new_project_name}@@.git<\/url>\n          <credentialsId>Jenkins<\/credentialsId>\n        <\/hudson.plugins.git.UserRemoteConfig>\n      <\/userRemoteConfigs>\n      <branches>\n        <hudson.plugins.git.BranchSpec>\n          <name>*\/master<\/name>\n        <\/hudson.plugins.git.BranchSpec>\n      <\/branches>\n      <doGenerateSubmoduleConfigurations>false<\/doGenerateSubmoduleConfigurations>\n      <submoduleCfg class=\"list\"\/>\n      <extensions\/>\n    <\/scm>\n    <scriptPath>Jenkinsfile<\/scriptPath>\n    <lightweight>true<\/lightweight>\n  <\/definition>\n  <triggers\/>\n  <authToken>ThisIsTheAPITokenToUse<\/authToken>\n  <disabled>false<\/disabled>\n<\/flow-definition>' | sudo su -c 'tee ~\/jobs\/@@{new_project_name}@@\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@\/builds\/legacyIds' - jenkins\n\necho \"Create @@{new_project_name}@@ App Deploy Job\"\nsudo su -c 'mkdir -p ~\/jobs\/@@{new_project_name}@@_deploy\/builds' - jenkins\nsudo su -c 'touch ~\/jobs\/@@{new_project_name}@@_deploy\/builds\/legacyIds' - jenkins\nsudo su -c 'echo 1 > ~\/jobs\/@@{new_project_name}@@_deploy\/nextBuildNumber' - jenkins\necho '<?xml version=\"1.1\" encoding=\"UTF-8\"?>\n<flow-definition plugin=\"workflow-job@2.23\">\n  <actions\/>\n  <description><\/description>\n  <keepDependencies>false<\/keepDependencies>\n  <properties>\n    <hudson.model.ParametersDefinitionProperty>\n      <parameterDefinitions>\n        <hudson.model.StringParameterDefinition>\n          <name>ARTIFACTORY_IP<\/name>\n          <description><\/description>\n          <defaultValue>@@{Artifactory.address}@@<\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>REPO_NAME<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n        <hudson.model.StringParameterDefinition>\n          <name>BUILD_NUMBER<\/name>\n          <description><\/description>\n          <defaultValue><\/defaultValue>\n          <trim>false<\/trim>\n        <\/hudson.model.StringParameterDefinition>\n      <\/parameterDefinitions>\n    <\/hudson.model.ParametersDefinitionProperty>\n  <\/properties>\n  <definition class=\"org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition\" plugin=\"workflow-cps@2.54\">\n    <script>import groovy.json.JsonSlurperClassic\nimport groovy.json.JsonOutput\n\nnode() {\n    stage(&apos;Deploy Application Via Calm&apos;){\n        echo &quot;Application deployment visual&quot;\n    }\n}\n\ndef response = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: false, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;]], ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@&apos;\n\nprintln(&quot;Status: &quot; + response.status)\n\/\/println(&quot;Content: &quot; + response.content)\n\ndef blueprint_spec = parseJSON(response.content)\ndef bp_index = 0\ndef var_index = 0\nblueprint_spec.remove(&apos;status&apos;)\nblueprint_spec[&apos;spec&apos;].remove(&apos;name&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;application_name&apos;] = REPO_NAME + &apos;@@{calm_random}@@Jenkins&apos; + BUILD_NUMBER.toString()\nblueprint_spec[&apos;spec&apos;][&apos;app_profile_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;app_profile&quot;, &quot;uuid&quot;: &quot;@@{app_profile_uuid}@@&quot;}&apos;)\nblueprint_spec[&apos;metadata&apos;][&apos;owner_reference&apos;] = parseJSON(&apos;{&quot;kind&quot;: &quot;user&quot;, &quot;uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;name&quot;: &quot;admin&quot;}&apos;)\nblueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;].each  { profileKey, profileRow -&gt; \n    println(&quot;Profile: ${profileKey}&quot;); \n    profileKey[&apos;variable_list&apos;].each { variableKey, variableRow -&gt;\n        println(&quot;Variable: ${variableKey}&quot;); \n        if (variableKey[&apos;name&apos;] == &apos;build_number&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = BUILD_NUMBER.toString()\n        } else if (variableKey[&apos;name&apos;] == &apos;project_name&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = REPO_NAME\n        } else if (variableKey[&apos;name&apos;] == &apos;artifactory_ip&apos;){\n                blueprint_spec[&apos;spec&apos;][&apos;resources&apos;][&apos;app_profile_list&apos;][bp_index][&apos;variable_list&apos;][var_index][&apos;value&apos;] = ARTIFACTORY_IP\n        }\n        var_index += 1;\n    }; \n    bp_index += 1;\n}\n\/\/println(&quot;Content: &quot; + blueprint_spec)\n\ndef payload = JsonOutput.toJson(blueprint_spec)\nprintln(&quot;Payload: &quot; + payload)\n\ndef result = httpRequest authentication: &apos;PC-User&apos;, consoleLogResponseBody: true, customHeaders: [[maskValue: false, name: &apos;Content-Type&apos;, value: &apos;application\/json&apos;], [maskValue: false, name: &apos;Accept&apos;, value: &apos;application\/json&apos;]], httpMode: &apos;POST&apos;, requestBody: payload, ignoreSslErrors: true, responseHandle: &apos;LEAVE_OPEN&apos;, url: &apos;https:\/\/@@{pc_instance_ip}@@:9440\/api\/nutanix\/v3\/blueprints\/@@{app_deploy_blueprint_uuid}@@\/launch&apos;\nprintln(&quot;Status: &quot; + response.status)\nprintln(&quot;Content: &quot; + response.content)\n\ndef parseJSON(json) {\n    return new groovy.json.JsonSlurperClassic().parseText(json)\n}\n<\/script>\n    <sandbox>true<\/sandbox>\n  <\/definition>\n  <triggers\/>\n  <disabled>false<\/disabled>\n<\/flow-definition>'  | sudo su -c 'tee ~\/jobs\/@@{new_project_name}@@_deploy\/config.xml' - jenkins\n\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/config.xml' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/nextBuildNumber' - jenkins\nsudo su -c 'chmod 644 ~\/jobs\/@@{new_project_name}@@_deploy\/builds\/legacyIds' - jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Initialize Workstation Git Repository","attrs":{"exit_status":[],"script":"echo \"Initialize DevOps Git Project\"\ngit clone git@@@{Gitolite.name}@@.@@{domain_name}@@:@@{new_project_name}@@.git\n\ncd @@{new_project_name}@@\n\ngit config user.name nutanix\ngit config user.email nutanix@@@{name}@@.@@{domain_name}@@\ngit config --global push.default matching\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart Jenkins Service","attrs":{"exit_status":[],"script":"sudo systemctl restart jenkins","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Wait for Restart","attrs":{"exit_status":[],"script":"echo 'Wait for Jenkins Instance Restart'\nsleep 30","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Version 1 Demo Code","attrs":{"exit_status":[],"script":"echo \"Get Demo Code\"\ncd @@{new_project_name}@@\nwget @@{new_code_seed_location}@@\/@@{new_code_seed}@@\ntar xvfz @@{new_code_seed}@@\nrm @@{new_code_seed}@@\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Jenkins Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Git Hook","attrs":{"exit_status":[],"script":"echo 'StrictHostKeyChecking no' > ~\/.ssh\/config\necho \"Create Hook\"\nssh @@{Gitolite.address}@@ 'printf \"#!\/bin\/bash\\n\/usr\/bin\/curl --user admin:@@{jenkins_authorization}@@ -s http:\/\/@@{address}@@:8080\/job\/@@{new_project_name}@@\/buildWithParameters?token=ThisIsTheAPITokenToUse\\n\" | sudo su -c \"tee ~\/repositories\/@@{new_project_name}@@.git\/hooks\/post-receive\" - git'\nssh @@{Gitolite.address}@@ 'sudo su -c \"chmod 775 ~\/repositories\/@@{new_project_name}@@.git\/hooks\/post-receive\" - git'\necho \"Complete Hook\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Developer Workstation"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create and Push Docker Images","attrs":{"exit_status":[],"script":"#export DOCKER_REGISTRY=@@{Docker Registry.name}@@.@@{domain_name}@@\nexport DOCKER_REGISTRY=@@{Nexus.vm_name}@@.@@{domain_name}@@\nexport PROJECT_NAME=@@{new_project_name}@@\necho \"Login into Docker Registry\"\n\n#docker login -u @@{Docker Registry Credential.username}@@ -p @@{Docker Registry Credential.secret}@@ $DOCKER_REGISTRY\ndocker login -u @@{Nexus Jenkins Credential.username}@@ -p @@{Nexus Jenkins Credential.secret}@@ $DOCKER_REGISTRY\ncd ~\/@@{new_project_name}@@\n\necho \"Build and Push Ansible Image\"\ndocker build -t ${DOCKER_REGISTRY}\/@@{new_project_name}@@\/ansible docker-ansible\/src\ndocker push ${DOCKER_REGISTRY}\/@@{new_project_name}@@\/ansible\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"3a932271_runbook","main_task_local_reference":{"kind":"app_task","name":"efbcbb73_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"new_app_deploy_blueprint","value":"CICD Application Deployment F5 VMs","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"new_code_seed","value":"cicd-demo-v1.tar.gz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"new_code_seed_location","value":"http:\/\/10.1.176.73\/artifacts","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"new_project_name","value":"demo","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"Add Pipeline"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Task1"}],"name":"52bb136c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"aa65c031_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Task1","attrs":{"scaling_count":"2","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"ab270777_runbook","main_task_local_reference":{"kind":"app_task","name":"52bb136c_dag"},"variable_list":[]},"name":"Scale Down Dev Workstation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Down"}],"name":"d7562e3b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"8cafc62e_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Down","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"31c4de29_runbook","main_task_local_reference":{"kind":"app_task","name":"d7562e3b_dag"},"variable_list":[]},"name":"Scale Down Jenkins Slave"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale UP"}],"name":"b536d0d0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"aa65c031_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale UP","attrs":{"scaling_count":"2","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"f3252490_runbook","main_task_local_reference":{"kind":"app_task","name":"b536d0d0_dag"},"variable_list":[]},"name":"Scale Up Dev Workstation"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Up"}],"name":"ae22a5e6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"8cafc62e_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Up","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"3801c5df_runbook","main_task_local_reference":{"kind":"app_task","name":"ae22a5e6_dag"},"variable_list":[]},"name":"Scale Up Jenkins Slave"}],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"domain_name","value":"ntnxlab.local","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"initial_app_deploy_blueprint","value":"Application Deployment K8s Karbon Containers","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"initial_code_seed","value":"cicd-demo-v1.tar.gz","label":"","editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"initial_code_seed_location","value":"https:\/\/matthewnutanixpublic.s3.us-east-2.amazonaws.com\/cicd\/cicd_no_artifactory","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"initial_project_name","value":"devops","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"jenkins_public_key","value":"ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAii7qFDhVadLx5lULAG\/ooCUTA\/ATSmXbArs+GdHxbUWd\/bNGZCXnaQ2L1mSVVGDxfTbSaTJ3En3tVlMtD2RjZPdhqWESCaoj2kXLYSiNDS9qz3SK6h822je\/f9O9CzCTrw2XGhnDVwmNraUvO5wmQObCDthTXc72PcBOd6oa4ENsnuY9HtiETg29TZXgCYPFXipLBHSZYkBmGgccAeY9dq5ywiywBJLuoSovXkkRJk3cd7GyhCRIwYzqfdgSmiAMYgJLrz\/UuLxatPqXts2D8v1xqR9EPNZNzgd4QHK4of1lqsNRuz2SxkwqLcXSw0mGcAL8mIwVpzhPzwmENC5Orw== rsa-key-20190108","label":"","is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"nutanix_public_key","value":"ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAii7qFDhVadLx5lULAG\/ooCUTA\/ATSmXbArs+GdHxbUWd\/bNGZCXnaQ2L1mSVVGDxfTbSaTJ3En3tVlMtD2RjZPdhqWESCaoj2kXLYSiNDS9qz3SK6h822je\/f9O9CzCTrw2XGhnDVwmNraUvO5wmQObCDthTXc72PcBOd6oa4ENsnuY9HtiETg29TZXgCYPFXipLBHSZYkBmGgccAeY9dq5ywiywBJLuoSovXkkRJk3cd7GyhCRIwYzqfdgSmiAMYgJLrz\/UuLxatPqXts2D8v1xqR9EPNZNzgd4QHK4of1lqsNRuz2SxkwqLcXSw0mGcAL8mIwVpzhPzwmENC5Orw== rsa-key-20190108","label":"","is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"pc_instance_ip","value":"10.42.94.39","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Domain_Server_IP","value":"10.42.94.41","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Domain_Server","value":"WIN-46KM0DADKEC","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"Nexus_Repo_Port","value":"18090","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"Nexus_Repo","value":"CentralRepo","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"Nexus_vmname","value":"n210406-044242","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Ubuntu Credential"},"type":"USER"},"name":"CICD_Nexus_Base2-20210208-Final"},"api_version":"3.0","metadata":{"last_update_time":"1617720646503685","kind":"blueprint","spec_version":5,"creation_time":"1617622282887634","name":"CICD_Nexus_Base2-20210208-Final"}}