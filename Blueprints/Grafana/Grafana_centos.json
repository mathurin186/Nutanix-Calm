{"status":{},"contains_secrets":true,"product_version":"3.2.0","spec":{"description":"","resources":{"client_attrs":{"None":{"y":252.9726388555,"x":996.0233998207},"d8a66e6a_deployment":{"y":-1932.8975221391,"x":-89.918836396}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"36092723_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c1686c3c_runbook","main_task_local_reference":{"kind":"app_task","name":"36092723_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"70ab52f5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"cd805572_runbook","main_task_local_reference":{"kind":"app_task","name":"70ab52f5_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Grafana"}],"name":"6c61bce4_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Grafana","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fb2122fb_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"f276f0ef_runbook","main_task_local_reference":{"kind":"app_task","name":"6c61bce4_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e59b19f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f481e3c6_runbook","main_task_local_reference":{"kind":"app_task","name":"e59b19f8_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ba5a300b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"1d9ff3df_runbook","main_task_local_reference":{"kind":"app_task","name":"ba5a300b_dag"},"variable_list":[]},"name":"action_restart"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Get Src Kubeconfig"},{"kind":"app_task","name":"Output Kubeconfig files"}],"name":"557f26b2_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Get Src Kubeconfig"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Output Kubeconfig files"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Src Kubeconfig","attrs":{"exit_status":[],"script":"payload ={}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\npc_user = '@@{Prism Central User.username}@@'\npc_pass = '@@{Prism Central User.secret}@@'\n\n# Set the address and make images call\nurl = \"https:\/\/localhost:9440\/karbon\/v1\/k8s\/clusters\/@@{SRC_KUBE_CONTEXT}@@\/kubeconfig\"\nresp = urlreq(url, verb='GET',params=json.dumps(payload), headers=headers, auth='BASIC', user=pc_user, passwd=pc_pass, verify=False)\n\nkubeconfig = resp.json()\n\n#with open('@@{SRC_KUBECONFIG_name}@@', 'w') as outfile:\n#  json.dump(kubeconfig['kube_config'], outfile)\n \nkubearray = kubeconfig['kube_config'].splitlines()\nprint \"src_server={}\".format(kubearray[8].rstrip('server:'))\nprint \"src_ca={}\".format(kubearray[9].rstrip('certificate-authority-data:'))\nprint \"src_token={}\".format(kubearray[13].rstrip('token:'))\n#print \"src_kubeconfig={}\".format(kubeconfig['kube_config'])","eval_variables":["src_kubeconfig"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Output Kubeconfig files","attrs":{"exit_status":[],"script":"rm \/home\/centos\/@@{SRC_KUBE_CONTEXT}@@-kubectl.cfg\necho \"\n# -*- mode: yaml; -*-\n# vim: syntax=yaml\n#\napiVersion: v1\nkind: Config\nclusters:\n- name: @@{SRC_KUBE_CONTEXT}@@\n  cluster:\n    @@{src_server}@@\n    @@{src_ca}@@ \nusers:\n- name: default-user-@@{SRC_KUBE_CONTEXT}@@\n  user:\n    @@{src_token}@@\ncontexts:\n- context:\n    cluster: @@{SRC_KUBE_CONTEXT}@@\n    user: default-user-@@{SRC_KUBE_CONTEXT}@@\n  name: @@{SRC_KUBE_CONTEXT}@@-context\ncurrent-context: @@{SRC_KUBE_CONTEXT}@@-context\" > \/home\/centos\/@@{SRC_KUBE_CONTEXT}@@-kubectl.cfg\n\n#echo @@{src_kubeconfig}@@ > @@{SRC_KUBECONFIG_name}@@\n#echo @@{dst_kubeconfig}@@ > @@{DST_KUBECONFIG_name}@@\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0b869ae1_runbook","main_task_local_reference":{"kind":"app_task","name":"557f26b2_dag"},"variable_list":[]},"name":"Download Kube Config"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Grafana"}],"name":"6f2d0915_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Grafana","attrs":{"exit_status":[],"script":"KUBECONFIG=\/home\/centos\/@@{SRC_KUBE_CONTEXT}@@-kubectl.cfg\nexport KUBECONFIG\n\nkubectl create ns monitoring\n\necho \"\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-datasources\n  namespace: monitoring\ndata:\n  prometheus.yaml: |-\n    {\n        \"apiVersion\": 1,\n        \"datasources\": [\n            {\n               \"access\":\"proxy\",\n                \"editable\": true,\n                \"name\": \"prometheus\",\n                \"orgId\": 1,\n                \"type\": \"prometheus\",\n                \"url\": \"http:\/\/prometheus-service.monitoring.svc:8080\",\n                \"version\": 1\n            }\n        ]\n    } \" > grafana-datasource-config.yaml\n\necho \"Creating ConfigMap\"\nkubectl create -n monitoring -f grafana-datasource-config.yaml\n\necho \"\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: grafana\n  namespace: monitoring\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: grafana\n  template:\n    metadata:\n      name: grafana\n      labels:\n        app: grafana\n    spec:\n      containers:\n      - name: grafana\n        image: grafana\/grafana:latest\n        ports:\n        - name: grafana\n          containerPort: 3000\n        resources:\n          limits:\n            memory: \"2Gi\"\n            cpu: \"1000m\"\n          requests: \n            memory: \"1Gi\"\n            cpu: \"500m\"\n        volumeMounts:\n          - mountPath: \/var\/lib\/grafana\n            name: grafana-storage\n          - mountPath: \/etc\/grafana\/provisioning\/datasources\n            name: grafana-datasources\n            readOnly: false\n      volumes:\n        - name: grafana-storage\n          emptyDir: {}\n        - name: grafana-datasources\n          configMap:\n              defaultMode: 420\n              name: grafana-datasources \" > grafana-deployment.yaml\n              \necho \"Deploying grafana\"\nkubectl create -n monitoring -f grafana-deployment.yaml\n\necho \"\napiVersion: v1\nkind: Service\nmetadata:\n  name: grafana\n  namespace: monitoring\n  annotations:\n      prometheus.io\/scrape: 'true'\n      prometheus.io\/port:   '3000'\nspec:\n  selector: \n    app: grafana\n  type: LoadBalancer  \n  ports:\n    - port: 3000\n      targetPort: 3000\n      nodePort: 32000 \" > grafana-service.yaml\n      \nkubectl create -n monitoring -f grafana-service.yaml\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fb2122fb_runbook","main_task_local_reference":{"kind":"app_task","name":"6f2d0915_dag"},"variable_list":[]},"name":"Install Grafana"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Delete Grafana"}],"name":"42ae5971_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delete Grafana","attrs":{"exit_status":[],"script":"KUBECONFIG=\/home\/centos\/@@{SRC_KUBE_CONTEXT}@@-kubectl.cfg\nexport KUBECONFIG\n\nkubectl delete ns monitoring","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1e1ffb0c_runbook","main_task_local_reference":{"kind":"app_task","name":"42ae5971_dag"},"variable_list":[]},"name":"Delete Grafana"}],"depends_on_list":[],"name":"Kubeconfig_client_service","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"src_kubeconfig","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"src_server","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"src_ca","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"src_token","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"kubeconfig_client_vm"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"953dbd61_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a7c2e494_runbook","main_task_local_reference":{"kind":"app_task","name":"953dbd61_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"kubeconfig_client_vm"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"147ad5b5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"cc785e5d_runbook","main_task_local_reference":{"kind":"app_task","name":"147ad5b5_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"kubeconfig_client_vm","readiness_probe":{"connection_type":"SSH","retries":"10","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"MO_kubectl_client-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"dd1a9fed-a931-48d4-9861-4ac102da2480"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nfqdn: @@{name}@@.gso.lab\nmanage_etc_hosts: true\nhostname: @@{name}@@\n\npassword: @@{Centos Credential.secret}@@\nchpasswd: { expire: False }\nssh_pwauth: True\n"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"6b21890b-a102-488a-8af0-d2ff24c1beee","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CENTOS_77","uuid":"d41597ee-e3fa-437d-a3fb-c578022a921c"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"vTrTUoAjQAAS9DAi+9napAPqjugAr0Ns4\/xQB+glR9d7+qORvPVoXJSY:utf-8"},"name":"Centos Credential"},{"username":"matthew.ong@apjsme.com","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"gtmvhAEmaUlGmVjbM\/wOrFpBof94FlHGNxPn3cwa0AT3WsXYNGVVVA==:utf-8"},"name":"Prism Central User"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Kubeconfig_client_service"}],"name":"Package4","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package4"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Curl"},{"kind":"app_task","name":"Get Src Kubeconfig"},{"kind":"app_task","name":"Output Kubeconfig files"},{"kind":"app_task","name":"Install Kubectl"}],"name":"064e2568_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install Curl"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Get Src Kubeconfig"}},{"from_task_reference":{"kind":"app_task","name":"Output Kubeconfig files"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install Kubectl"}},{"from_task_reference":{"kind":"app_task","name":"Get Src Kubeconfig"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Output Kubeconfig files"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Curl","attrs":{"exit_status":[],"script":"#sudo apt-get -y update\n#sudo apt install -y curl\nsudo yum update -y\nsudo yum install -y curl","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Get Src Kubeconfig","attrs":{"exit_status":[],"script":"payload ={}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\npc_user = '@@{Prism Central User.username}@@'\npc_pass = '@@{Prism Central User.secret}@@'\n\n# Set the address and make images call\nurl = \"https:\/\/localhost:9440\/karbon\/v1\/k8s\/clusters\/@@{SRC_KUBE_CONTEXT}@@\/kubeconfig\"\nresp = urlreq(url, verb='GET',params=json.dumps(payload), headers=headers, auth='BASIC', user=pc_user, passwd=pc_pass, verify=False)\n\nkubeconfig = resp.json()\n\n#with open('@@{SRC_KUBECONFIG_name}@@', 'w') as outfile:\n#  json.dump(kubeconfig['kube_config'], outfile)\n \nkubearray = kubeconfig['kube_config'].splitlines()\nprint \"src_server={}\".format(kubearray[8].rstrip('server:'))\nprint \"src_ca={}\".format(kubearray[9].rstrip('certificate-authority-data:'))\nprint \"src_token={}\".format(kubearray[13].rstrip('token:'))\n#print \"src_kubeconfig={}\".format(kubeconfig['kube_config'])","eval_variables":["src_kubeconfig","src_server","src_ca","src_token"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Output Kubeconfig files","attrs":{"exit_status":[],"script":"echo \"\n# -*- mode: yaml; -*-\n# vim: syntax=yaml\n#\napiVersion: v1\nkind: Config\nclusters:\n- name: @@{SRC_KUBE_CONTEXT}@@\n  cluster:\n    @@{src_server}@@\n    @@{src_ca}@@ \nusers:\n- name: default-user-@@{SRC_KUBE_CONTEXT}@@\n  user:\n    @@{src_token}@@\ncontexts:\n- context:\n    cluster: @@{SRC_KUBE_CONTEXT}@@\n    user: default-user-@@{SRC_KUBE_CONTEXT}@@\n  name: @@{SRC_KUBE_CONTEXT}@@-context\ncurrent-context: @@{SRC_KUBE_CONTEXT}@@-context\" > \/home\/centos\/@@{SRC_KUBE_CONTEXT}@@-kubectl.cfg\n\n#echo @@{src_kubeconfig}@@ > @@{SRC_KUBECONFIG_name}@@\n#echo @@{dst_kubeconfig}@@ > @@{DST_KUBECONFIG_name}@@\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Kubectl","attrs":{"exit_status":[],"script":"curl -LO https:\/\/storage.googleapis.com\/kubernetes-release\/release\/$(curl -s https:\/\/storage.googleapis.com\/kubernetes-release\/release\/stable.txt)\/bin\/linux\/amd64\/kubectl\nchmod +x .\/kubectl\nsudo mv .\/kubectl \/usr\/local\/bin\/kubectl","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98c4653d_runbook","main_task_local_reference":{"kind":"app_task","name":"064e2568_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package4"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e00af727_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"99516a1b_runbook","main_task_local_reference":{"kind":"app_task","name":"e00af727_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"d8a66e6a_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package4"}],"substrate_local_reference":{"kind":"app_substrate","name":"kubeconfig_client_vm"},"variable_list":[],"description":""}],"environment_reference_list":[],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Download Kube Config"}],"name":"2361ba60_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Download Kube Config","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"0b869ae1_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"5e0e7646_runbook","main_task_local_reference":{"kind":"app_task","name":"2361ba60_dag"},"variable_list":[]},"name":"Download Kube Config"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install Grafana"}],"name":"cc7d3f86_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install Grafana","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fb2122fb_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"3277273a_runbook","main_task_local_reference":{"kind":"app_task","name":"cc7d3f86_dag"},"variable_list":[]},"name":"Install Grafana"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Delete Grafana"}],"name":"801c5319_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Kubeconfig_client_service"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Delete Grafana","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"1e1ffb0c_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"4b1c1ac6_runbook","main_task_local_reference":{"kind":"app_task","name":"801c5319_dag"},"variable_list":[]},"name":"Delete Grafana"}],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"EXEC_LOCAL","name":"SRC_KUBE_CONTEXT","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"EXEC","attrs":{"script":"payload ={}\nheaders = {'Content-Type': 'application\/json', 'Accept': 'application\/json'}\npc_user = 'matthew.ong@apjsme.com'\npc_pass = '9O9bfV0y'\n\n# Set the address and make images call\nurl = \"https:\/\/localhost:9440\/karbon\/v1-beta.1\/k8s\/clusters\"\n\nr = urlreq(url, verb='GET',params=json.dumps(payload), headers=headers, auth='BASIC', user=pc_user, passwd=pc_pass, verify=False)\n#print(\"Status code: {}\".format(r.status_code))\n    \ncluster_list_json = r.json()\ncluster_list = []\n# deal with the result\/response\nif r.ok:\n  for cluster in cluster_list_json:\n    if cluster['name']:\n      cluster_list.append(cluster['name'])\nelse:\n  print(\"Request failed\")\n  print(\"Headers: {}\".format(headers))\n  print('Status code: {}'.format(r.status_code))\n  print('Response: {}'.format(json.dumps(json.loads(r.content), indent=4)))\n  exit(1)\n# endregion\n\nprint \",\".join(cluster_list)","type":"EXEC","command_line_args":"","exit_status":[],"script_type":"static"}}},{"val_type":"STRING","is_mandatory":true,"description":"Prism Central IP","data_type":"BASE","type":"LOCAL","name":"PC_IP","value":"10.139.80.88","label":"Please key in the Prism Central IP","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"Centos Credential"},"type":"USER"},"name":"Grafana_centos"},"api_version":"3.0","metadata":{"last_update_time":"1615266638442970","kind":"blueprint","spec_version":7,"creation_time":"1615264362905620","name":"Grafana_centos"}}